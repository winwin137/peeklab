var cs=Object.defineProperty;var us=(t,s,a)=>s in t?cs(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var re=(t,s,a)=>us(t,typeof s!="symbol"?s+"":s,a);import{i as ms,P as gs,g as ps,a as hs,b as fs,c as xs,G as js,r as l,u as gt,o as vs,j as e,s as tt,d as bs,e as Ns,f as ys,W as ws,h as X,k as Rs,m as Ss,l as be,y as Ke,n as Ze,N as As,t as Es,p as Ts,L as pt,T as ht,C as ft,R as ks,q as ke,S as Is,X as Ie,v as xt,w as Ms,M as Os,x as _e,_ as Ne,z as Ve,A as st,B as Y,D as jt,E as ae,F as vt,H as bt,I as Ds,J as Nt,K as Ls,O as Cs,Q as Ps,U as $s,V as yt,Y as Gs,Z as Me,$ as Oe,a0 as De,a1 as Le,a2 as Ce,a3 as Pe,a4 as $e,a5 as Fs,a6 as se,a7 as wt,a8 as Bs,a9 as Rt,aa as St,ab as Us,ac as At,ad as Et,ae as Hs,af as zs,ag as _s,ah as Vs,ai as Ys,aj as qs,ak as Tt,al as kt,am as Ws,an as Ye,ao as It,ap as at,aq as nt,ar as rt,as as it,at as ot,au as lt,av as Mt,aw as Ot,ax as Dt,ay as Lt,az as Ks,aA as Ct,aB as Zs,aC as Pt,aD as $t,aE as Gt,aF as Ft,aG as Xs,aH as Bt,aI as Js,aJ as Ut,aK as Ht,aL as Qs,aM as ea,aN as ta,aO as sa,aP as aa,aQ as na,aR as ra,aS as ia,aT as oa,aU as zt,aV as la,aW as da,aX as ee,aY as ca}from"./vendor-C6R181A3.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const d of n)if(d.type==="childList")for(const i of d.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const d={};return n.integrity&&(d.integrity=n.integrity),n.referrerPolicy&&(d.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?d.credentials="include":n.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(n){if(n.ep)return;n.ep=!0;const d=a(n);fetch(n.href,d)}})();const ua={apiKey:"AIzaSyBXo8aHR1FdhUeJDiH-eIseAue5SAgcTfI",authDomain:"newpeekwind.firebaseapp.com",projectId:"newpeekwind",storageBucket:"newpeekwind.appspot.com",messagingSenderId:"403242235671",appId:"1:403242235671:web:f204cbb8ab9c605dd12952",measurementId:"G-NLP2TN948M"};let ve,C,de,ma,ga=null;try{ve=ms(ua),C=gs(ve),de=ps(ve),ma=hs(ve),fs().then(t=>{t&&(ga=xs(ve))}).catch(console.error)}catch(t){console.error("Error initializing Firebase:",t),console.error("Firebase initialization error:",t)}const Ge=new js;Ge.addScope("https://www.googleapis.com/auth/userinfo.email");Ge.addScope("https://www.googleapis.com/auth/userinfo.profile");Ge.setCustomParameters({prompt:"select_account"});const pa=1,ha=1e6;let Be=0;function fa(){return Be=(Be+1)%Number.MAX_SAFE_INTEGER,Be.toString()}const Ue=new Map,dt=t=>{if(Ue.has(t))return;const s=setTimeout(()=>{Ue.delete(t),ye({type:"REMOVE_TOAST",toastId:t})},ha);Ue.set(t,s)},xa=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,pa)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(a=>a.id===s.toast.id?{...a,...s.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=s;return a?dt(a):t.toasts.forEach(r=>{dt(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==s.toastId)}}},Ae=[];let Ee={toasts:[]};function ye(t){Ee=xa(Ee,t),Ae.forEach(s=>{s(Ee)})}function me({...t}){const s=fa(),a=n=>ye({type:"UPDATE_TOAST",toast:{...n,id:s}}),r=()=>ye({type:"DISMISS_TOAST",toastId:s});return ye({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:n=>{n||r()}}}),{id:s,dismiss:r,update:a}}function Fe(){const[t,s]=l.useState(Ee);return l.useEffect(()=>(Ae.push(s),()=>{const a=Ae.indexOf(s);a>-1&&Ae.splice(a,1)}),[t]),{...t,toast:me,dismiss:a=>ye({type:"DISMISS_TOAST",toastId:a})}}const _t=l.createContext(void 0),ja=({children:t})=>{const[s,a]=l.useState(null),[r,n]=l.useState(!0),d=gt(),{toast:i}=Fe();l.useEffect(()=>{const p=vs(de,b=>{console.log("Auth state changed:",b?`User: ${b.displayName}`:"No user"),a(b),n(!1)});return()=>p()},[]);const v={user:s,loading:r,signIn:async(p,b)=>{try{await tt(de,p,b),d("/dashboard")}catch(u){throw console.error("Error signing in:",u),u}},signUp:async(p,b)=>{try{await bs(de,p,b),d("/dashboard")}catch(u){throw console.error("Error signing up:",u),u}},signInWithGoogle:async()=>{try{n(!0),console.log("Starting Google sign-in process");const p=await Ns(de,Ge);console.log("Google sign-in successful",p.user.displayName),i({title:"Success",description:"You are now signed in with Google!"}),d("/dashboard")}catch(p){throw console.error("Google sign-in error:",p),i({title:"Error signing in with Google",description:p instanceof Error?p.message:"Unknown error",variant:"destructive"}),p}finally{n(!1)}},createTestAccount:async()=>{try{n(!0);const p="test@peekdiet.com";await tt(de,p,"Asdf1234!"),i({title:"Using Test Account",description:`Signed in with Email: ${p}`}),d("/dashboard")}catch(p){throw console.error("Test account error:",p),i({title:"Error using test account",description:p instanceof Error?p.message:"Unknown error",variant:"destructive"}),p}finally{n(!1)}},logout:async()=>{try{await ys(de),d("/login")}catch(p){throw console.error("Error signing out:",p),p}}};return e.jsx(_t.Provider,{value:v,children:t})},ne=()=>{const t=l.useContext(_t);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},ce=class ce{constructor(){re(this,"pendingOperations",[]);re(this,"isOnline",navigator.onLine);re(this,"syncStatus","synced");re(this,"syncInterval",null);re(this,"handleOnline",()=>{this.isOnline=!0,this.syncPendingOperations()});re(this,"handleOffline",()=>{this.isOnline=!1});window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),this.startSyncInterval()}static getInstance(){return ce.instance||(ce.instance=new ce),ce.instance}startSyncInterval(){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval(()=>{this.isOnline&&this.pendingOperations.length>0&&this.syncPendingOperations()},5e3)}async queueOperation(s){const a={...s,timestamp:Date.now()};this.pendingOperations.push(a),this.syncStatus="pending",localStorage.setItem("pendingOperations",JSON.stringify(this.pendingOperations)),this.isOnline&&await this.syncPendingOperations()}async syncPendingOperations(){if(this.syncStatus==="syncing"||!this.isOnline)return;this.syncStatus="syncing";const s=ws(C),a=[];try{for(let r=0;r<this.pendingOperations.length;r++){const n=this.pendingOperations[r],d=X(C,n.collection,n.docId);switch(n.type){case"create":s.set(d,n.data);break;case"update":s.update(d,n.data);break;case"delete":s.delete(d);break}}await s.commit(),a.push(...this.pendingOperations.map((r,n)=>n))}catch(r){console.error("Error syncing operations:",r)}finally{this.pendingOperations=this.pendingOperations.filter((r,n)=>!a.includes(n)),localStorage.setItem("pendingOperations",JSON.stringify(this.pendingOperations)),this.syncStatus=this.pendingOperations.length>0?"pending":"synced"}}getSyncStatus(){return{isOnline:this.isOnline,status:this.syncStatus,pendingOperations:this.pendingOperations.length}}async getDocument(s,a){const r=X(C,s,a);return Rs(r)}async setDocument(s,a,r){if(this.isOnline)try{const n=X(C,s,a);return await Ss(n,r),!0}catch(n){return console.error("Error setting document:",n),!1}else return await this.queueOperation({type:"create",collection:s,docId:a,data:r}),!0}async updateDocument(s,a,r){if(this.isOnline)try{const n=X(C,s,a);return await be(n,r),!0}catch(n){return console.error("Error updating document:",n),!1}else return await this.queueOperation({type:"update",collection:s,docId:a,data:r}),!0}async deleteDocument(s,a){if(this.isOnline)try{const r=X(C,s,a);return await Ke(r),!0}catch(r){return console.error("Error deleting document:",r),!1}else return await this.queueOperation({type:"delete",collection:s,docId:a}),!0}};re(ce,"instance");let qe=ce;const te=qe.getInstance(),va=()=>{const[t,s]=l.useState(te.getSyncStatus());return l.useEffect(()=>{const a=()=>{s(te.getSyncStatus())};window.addEventListener("online",a),window.addEventListener("offline",a);const r=setInterval(a,5e3);return()=>{window.removeEventListener("online",a),window.removeEventListener("offline",a),clearInterval(r)}},[]),{...t,setDocument:te.setDocument.bind(te),updateDocument:te.updateDocument.bind(te),deleteDocument:te.deleteDocument.bind(te),getDocument:te.getDocument.bind(te)}},ba=()=>{const{isOnline:t,status:s,pendingOperations:a}=va(),r=()=>t?s==="synced"?"bg-green-500":s==="syncing"?"bg-blue-500":"bg-yellow-500":"bg-yellow-500",n=()=>t?s==="synced"?"Synced":s==="syncing"?"Syncing...":`Pending (${a})`:"Offline";return e.jsxs("div",{className:"fixed bottom-4 right-4 flex items-center space-x-2 bg-white p-2 rounded-lg shadow",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${r()}`}),e.jsx("span",{className:"text-sm text-gray-700",children:n()})]})},ie=({children:t})=>{const{user:s,loading:a}=ne(),r=Ze();return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-peekdiet-secondary"}),e.jsx("div",{className:"mt-4 h-4 w-32 bg-muted rounded"})]})}):s?e.jsx(e.Fragment,{children:t}):e.jsx(As,{to:"/login",state:{from:r},replace:!0})};function S(...t){return Es(Ts(t))}const B=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:S("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s}));B.displayName="Card";const U=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:S("flex flex-col space-y-1.5 p-6",t),...s}));U.displayName="CardHeader";const H=l.forwardRef(({className:t,...s},a)=>e.jsx("h3",{ref:a,className:S("text-2xl font-semibold leading-none tracking-tight",t),...s}));H.displayName="CardTitle";const J=l.forwardRef(({className:t,...s},a)=>e.jsx("p",{ref:a,className:S("text-sm text-muted-foreground",t),...s}));J.displayName="CardDescription";const z=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:S("p-6 pt-0",t),...s}));z.displayName="CardContent";const Re=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:S("flex items-center p-6 pt-0",t),...s}));Re.displayName="CardFooter";const Na=ks,Vt=l.forwardRef(({className:t,...s},a)=>e.jsx(pt,{ref:a,className:S("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));Vt.displayName=pt.displayName;const Yt=l.forwardRef(({className:t,...s},a)=>e.jsx(ht,{ref:a,className:S("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s}));Yt.displayName=ht.displayName;const qt=l.forwardRef(({className:t,...s},a)=>e.jsx(ft,{ref:a,className:S("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));qt.displayName=ft.displayName;const ya=ke("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),O=l.forwardRef(({className:t,variant:s,size:a,asChild:r=!1,...n},d)=>{const i=r?Is:"button";return e.jsx(i,{className:S(ya({variant:s,size:a,className:t})),ref:d,...n})});O.displayName="Button";const wa=ke("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Xe=l.forwardRef(({className:t,variant:s,...a},r)=>e.jsx("div",{ref:r,role:"alert",className:S(wa({variant:s}),t),...a}));Xe.displayName="Alert";const Ra=l.forwardRef(({className:t,...s},a)=>e.jsx("h5",{ref:a,className:S("mb-1 font-medium leading-none tracking-tight",t),...s}));Ra.displayName="AlertTitle";const Je=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:S("text-sm [&_p]:leading-relaxed",t),...s}));Je.displayName="AlertDescription";const Sa=()=>{const{signInWithGoogle:t,loading:s}=ne(),[a,r]=l.useState(null),n=async()=>{try{r(null),await t()}catch(d){console.error("Failed to sign in with Google:",d),d instanceof Error?d.message.includes("auth/unauthorized-domain")?r("This domain is not authorized for Google sign-in. Please add it to your Firebase authentication settings."):d.message.includes("auth/popup-closed-by-user")?r("Sign-in popup was closed. Please try again."):d.message.includes("auth/popup-blocked")?r("Sign-in popup was blocked by your browser. Please allow popups for this site."):r(`Authentication error: ${d.message}`):r("An unknown error occurred. Please try again later.")}};return e.jsxs("div",{className:"space-y-2 w-full",children:[a&&e.jsx(Xe,{variant:"destructive",className:"mb-2",children:e.jsxs(Je,{className:"flex justify-between items-center",children:[e.jsx("span",{children:a}),e.jsx(Ie,{className:"h-4 w-4 cursor-pointer",onClick:()=>r(null)})]})}),e.jsxs(O,{variant:"outline",onClick:n,disabled:s,className:"w-full flex items-center gap-2",children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",children:e.jsxs("g",{transform:"matrix(1, 0, 0, 1, 27.009001, -39.238998)",children:[e.jsx("path",{fill:"#4285F4",d:"M -3.264 51.509 C -3.264 50.719 -3.334 49.969 -3.454 49.239 L -14.754 49.239 L -14.754 53.749 L -8.284 53.749 C -8.574 55.229 -9.424 56.479 -10.684 57.329 L -10.684 60.329 L -6.824 60.329 C -4.564 58.239 -3.264 55.159 -3.264 51.509 Z"}),e.jsx("path",{fill:"#34A853",d:"M -14.754 63.239 C -11.514 63.239 -8.804 62.159 -6.824 60.329 L -10.684 57.329 C -11.764 58.049 -13.134 58.489 -14.754 58.489 C -17.884 58.489 -20.534 56.379 -21.484 53.529 L -25.464 53.529 L -25.464 56.619 C -23.494 60.539 -19.444 63.239 -14.754 63.239 Z"}),e.jsx("path",{fill:"#FBBC05",d:"M -21.484 53.529 C -21.734 52.809 -21.864 52.039 -21.864 51.239 C -21.864 50.439 -21.724 49.669 -21.484 48.949 L -21.484 45.859 L -25.464 45.859 C -26.284 47.479 -26.754 49.299 -26.754 51.239 C -26.754 53.179 -26.284 54.999 -25.464 56.619 L -21.484 53.529 Z"}),e.jsx("path",{fill:"#EA4335",d:"M -14.754 43.989 C -12.984 43.989 -11.404 44.599 -10.154 45.789 L -6.734 42.369 C -8.804 40.429 -11.514 39.239 -14.754 39.239 C -19.444 39.239 -23.494 41.939 -25.464 45.859 L -21.484 48.949 C -20.534 46.099 -17.884 43.989 -14.754 43.989 Z"})]})}),"Sign in with Google"]})]})},we=l.forwardRef(({className:t,type:s,...a},r)=>e.jsx("input",{type:s,className:S("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...a}));we.displayName="Input";const Aa=ke("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ue=l.forwardRef(({className:t,...s},a)=>e.jsx(xt,{ref:a,className:S(Aa(),t),...s}));ue.displayName=xt.displayName;const Ea=()=>{const{signIn:t,signUp:s,loading:a}=ne(),[r,n]=l.useState(""),[d,i]=l.useState(""),[o,m]=l.useState(!1),[x,c]=l.useState(null),g=async v=>{v.preventDefault();try{c(null),o?await s(r,d):await t(r,d)}catch(p){console.error("Authentication error:",p),p instanceof Error?p.message.includes("auth/invalid-email")?c("Please enter a valid email address."):p.message.includes("auth/user-not-found")?c("No account found with this email address."):p.message.includes("auth/wrong-password")?c("Incorrect password. Please try again."):p.message.includes("auth/email-already-in-use")?c("This email is already registered. Please sign in instead."):p.message.includes("auth/weak-password")?c("Password should be at least 6 characters long."):c(`Authentication error: ${p.message}`):c("An unknown error occurred. Please try again later.")}};return e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[x&&e.jsx(Xe,{variant:"destructive",children:e.jsxs(Je,{className:"flex justify-between items-center",children:[e.jsx("span",{children:x}),e.jsx(Ie,{className:"h-4 w-4 cursor-pointer",onClick:()=>c(null)})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{htmlFor:"email",children:"Email"}),e.jsx(we,{id:"email",type:"email",placeholder:"Enter your email",value:r,onChange:v=>n(v.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{htmlFor:"password",children:"Password"}),e.jsx(we,{id:"password",type:"password",placeholder:"Enter your password",value:d,onChange:v=>i(v.target.value),required:!0})]}),e.jsx(O,{type:"submit",className:"w-full",disabled:a,children:o?"Sign Up":"Sign In"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>m(!o),className:"text-sm text-muted-foreground hover:text-primary",children:o?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})},Ta=()=>{l.useEffect(()=>{const t=()=>{document.body.style.height=`${window.innerHeight}px`};return window.addEventListener("resize",t),t(),()=>{window.removeEventListener("resize",t)}},[])},ka="1.6.0",Ia=()=>{Ta();const[t,s]=l.useState("email"),{createTestAccount:a,loading:r}=ne();return gt(),e.jsx("div",{id:"auth-container",className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-b from-peekdiet-light to-background",children:e.jsxs(B,{className:"w-full max-w-md",children:[e.jsx(U,{className:"space-y-1",children:e.jsx(H,{className:"text-2xl text-center"})}),e.jsxs(z,{children:[e.jsxs(Na,{value:t,onValueChange:s,className:"w-full",children:[e.jsx(Vt,{className:"grid w-full grid-cols-1",children:e.jsx(Yt,{value:"email",children:"Email"})}),e.jsx(qt,{value:"email",children:e.jsx(Ea,{})})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Sa,{})}),e.jsx("div",{className:"text-center",children:e.jsx(O,{variant:"outline",className:"w-full text-sm",onClick:a,disabled:r,children:"Use Test Account (test@peekdiet.com / Asdf1234!)"})})]})]}),e.jsx(Re,{className:"flex flex-col space-y-2",children:e.jsxs("div",{className:"text-sm text-center text-muted-foreground",children:[e.jsx("p",{children:"By signing in, you agree to our terms of service and privacy policy."}),e.jsxs("p",{className:"mt-1 text-xs",children:["Version ",ka]})]})})]})})},je={timeout:{original:7,testing:2},cycleTimeout:{original:190,testing:21},intervals:{original:{firstBite:0,readings:[20,40,60,90,120,180]},testing:{firstBite:0,readings:[3,6,9,12,15,18]}}},ge=(t="original")=>t==="testing"?je.intervals.testing:je.intervals.original,Wt=(t="original")=>t==="testing"?je.timeout.testing:je.timeout.original,fe=(t="original")=>t==="testing"?je.cycleTimeout.testing:je.cycleTimeout.original,Ma=()=>{const t=Date.now(),s=Math.random().toString(36).substring(2,8);return`mc-${t}-${s}`},he=(t="original")=>{const{user:s}=ne(),[a,r]=l.useState([]),[n,d]=l.useState(null),[i,o]=l.useState(null),[m,x]=l.useState(!0),[c,g]=l.useState(!1),[v,p]=l.useState(null),[b,u]=l.useState([]),{toast:j}=Fe(),P=l.useRef(!1),[D,A]=l.useState(!1);l.useRef(0),l.useEffect(()=>{if(P.current)return;const h=async()=>{g(!1);try{await Ms(C),j({title:"You're back online",description:"Your data will now sync with the server."}),k()}catch(y){console.error("Error enabling network:",y),j({title:"Connection Error",description:"Failed to reconnect to the server. Please try again.",variant:"destructive"})}},f=async()=>{g(!0);try{await Os(C),j({title:"You're offline",description:"The app will continue to work, but changes won't be saved to the server until you're back online.",variant:"destructive"})}catch(y){console.error("Error disabling network:",y)}};return window.addEventListener("online",h),window.addEventListener("offline",f),g(!navigator.onLine),P.current=!0,()=>{window.removeEventListener("online",h),window.removeEventListener("offline",f)}},[j]);const k=async()=>{if(b.length===0)return;const h=[...b];u([]);for(const f of h)try{switch(f.type){case"start":await $(f.data.preprandialValue);break;case"firstBite":await K();break;case"reading":await Z(f.data.minutesMark,f.data.value);break;case"abandon":await N();break}}catch(y){console.error(`Failed to retry ${f.type} action:`,y),u(T=>[...T,f])}};l.useEffect(()=>{if(!s){r([]),d(null),o(null),x(!1);return}(async()=>{try{x(!0),p(null);const f=_e(Ne(C,"mealCycles"),Ve("userId","==",s.uid)),y=await st(f),T=[];y.forEach(E=>{const w=E.data(),F=w.createdAt instanceof Y?w.createdAt.toMillis():w.createdAt,q=w.updatedAt instanceof Y?w.updatedAt.toMillis():w.updatedAt,_=w.startTime instanceof Y?w.startTime.toMillis():w.startTime,R=w.preprandialReading?{...w.preprandialReading,timestamp:w.preprandialReading.timestamp instanceof Y?w.preprandialReading.timestamp.toMillis():w.preprandialReading.timestamp,createdAt:w.preprandialReading.createdAt instanceof Y?w.preprandialReading.createdAt.toMillis():w.preprandialReading.createdAt,updatedAt:w.preprandialReading.updatedAt instanceof Y?w.preprandialReading.updatedAt.toMillis():w.preprandialReading.updatedAt}:void 0,L=w.postprandialReadings?Object.entries(w.postprandialReadings).reduce((oe,[le,Se])=>(oe[le]={...Se,timestamp:Se.timestamp instanceof Y?Se.timestamp.toMillis():Se.timestamp},oe),{}):{},Q={id:E.id,...w,status:w.archived?"abandoned":w.status,createdAt:F,updatedAt:q,startTime:_,preprandialReading:R,postprandialReadings:L};T.push(Q)}),T.sort((E,w)=>w.createdAt-E.createdAt),r(T);const M=T.find(E=>E.status==="active"&&!E.archived);(!n||!T.find(E=>E.id===n.id)||n.status!=="active"||n.archived)&&d(M||null),o(null)}catch(f){console.error("Error fetching meal cycles:",f),c||!navigator.onLine?p("You're currently offline. Your data will sync when you're back online."):p("Could not connect to the database. Please try again later.")}finally{x(!1)}})()},[s,c,j]);const $=async h=>{if(!s)return null;p(null),A(!0);try{const f=Y.now(),y=f.toMillis(),T=Ma(),M={userId:s.uid,value:h,timestamp:f,type:"preprandial",createdAt:f,updatedAt:f},E={userId:s.uid,startTime:0,preprandialReading:{id:"temp_"+y,...M},postprandialReadings:{},status:"active",createdAt:f,updatedAt:f,uniqueId:T};return o(E),c||!navigator.onLine?(j({title:"Preprandial reading saved",description:"You're offline, but you can continue with your meal cycle. Your data will sync when you're back online."}),u(F=>[...F,{type:"start",data:{preprandialValue:h},timestamp:y}]),A(!1),E):((async()=>{try{const F=await jt(Ne(C,"mealCycles"),E),q={id:F.id,...E,preprandialReading:{id:F.id+"_pre",...M}};r(_=>[q,..._]),d(q),o(null),j({title:"Meal cycle started",description:`Your preprandial reading has been recorded (ID: ${T.substring(0,8)}). Press 'First Bite' when you start eating.`})}catch(F){console.error("Error saving to Firestore:",F),u(q=>[...q,{type:"start",data:{preprandialValue:h},timestamp:y}]),j({title:"Offline Mode",description:"Your data will sync when you're back online.",variant:"destructive"})}})().catch(console.error),A(!1),E)}catch(f){return console.error("Error starting meal cycle:",f),j({title:"Error starting meal cycle",description:f instanceof Error?f.message:"Unknown error",variant:"destructive"}),p("Failed to start meal cycle. Please try again."),A(!1),null}},K=async()=>{if(!s)return null;p(null);try{const h=Y.now(),f=h.toMillis();if(i){const T={...i,startTime:f,updatedAt:f};if(o(null),d(T),r(M=>[T,...M]),j({title:"First bite recorded",description:"Your meal cycle timer has started. You'll receive notifications for glucose readings."}),c||!navigator.onLine)return u(M=>[...M,{type:"firstBite",data:{},timestamp:f}]),T;try{const M=X(C,"mealCycles",T.id);await be(M,{startTime:h,updatedAt:h})}catch(M){console.error("Error saving first bite to Firestore:",M),u(E=>[...E,{type:"firstBite",data:{},timestamp:f}])}return T}if(!n)return j({title:"No active meal cycle",description:"Please start a meal cycle first.",variant:"destructive"}),null;const y={...n,startTime:f,updatedAt:f};if(d(y),r(T=>T.map(M=>M.id===y.id?y:M)),j({title:"First bite recorded",description:"Your meal cycle timer has started. You'll receive notifications for glucose readings."}),c||!navigator.onLine)return u(T=>[...T,{type:"firstBite",data:{},timestamp:f}]),y;try{await be(X(C,"mealCycles",n.id),{startTime:h,updatedAt:h})}catch(T){console.error("Error saving first bite to Firestore:",T),u(M=>[...M,{type:"firstBite",data:{},timestamp:f}])}return y}catch(h){return console.error("Error recording first bite:",h),j({title:"Error recording first bite",description:h instanceof Error?h.message:"Unknown error",variant:"destructive"}),null}},Z=async(h,f)=>{if(!n||!s)return null;try{const y=Y.now(),T=y.toMillis(),M=n.startTime+h*60*1e3,E=Wt(t);if(T>M+E*60*1e3)return j({title:"Reading too late",description:`You're more than ${E} minutes late for the ${h}-minute reading. This reading will not be counted.`,variant:"destructive"}),null;const F={userId:s.uid,value:f,timestamp:y,type:"postprandial",minutesMark:h,createdAt:y,updatedAt:y};console.log(`ðŸ“Š Glucose Reading Submitted:
  - Time Mark: ${h} minutes
  - Value: ${f} mg/dL
  - Readings Count: ${Object.keys(n.postprandialReadings).length+1}/6`);const q={...n.postprandialReadings,[h]:F},_=h===180,R=_?"completed":"active";await be(X(C,"mealCycles",n.id),{[`postprandialReadings.${h}`]:F,status:R,updatedAt:y});const L={...n,postprandialReadings:q,status:R,updatedAt:T};return r(Q=>Q.map(oe=>oe.id===L.id?L:oe)),_?(d(null),j({title:"Meal cycle completed",description:"Your 3-hour meal cycle is now complete. You can view the results in your history."})):(d(L),j({title:"Reading recorded",description:`Your ${h}-minute reading has been saved successfully.`})),L}catch(y){return j({title:"Error recording reading",description:y instanceof Error?y.message:"Unknown error",variant:"destructive"}),null}},N=async h=>{if(!n||!s)return!1;try{if(console.log("Updating meal cycle status:",n.id),["completed","canceled"].includes(n.status))return j({title:"Cannot change meal cycle status",description:`This meal cycle is already ${n.status}.`,variant:"destructive"}),!1;const f=ge(t).readings[5],y=n.postprandialReadings&&n.postprandialReadings[f]!==void 0;y&&(h={status:"completed"});const M=ge(t).readings.every(w=>n.postprandialReadings&&n.postprandialReadings[w]!==void 0);y&&(h={status:"completed"});const E=(h==null?void 0:h.status)||(h!=null&&h.userInitiated?"canceled":"abandoned");if(c||!navigator.onLine){if(console.log("Updating meal cycle status offline"),n.id.startsWith("temp_")||!n.id)r(w=>w.filter(F=>F.id!==n.id));else{const F=Y.now().toMillis();r(q=>q.map(_=>_.id===n.id?{..._,status:E,updatedAt:F}:_))}return d(null),j({title:`Meal Cycle ${E.charAt(0).toUpperCase()+E.slice(1)}`,description:`Your current meal cycle has been ${E}.`}),!0}try{console.log(`Marking meal cycle status: ${n.id}`);const w=Y.now(),F=w.toMillis();return await be(X(C,"mealCycles",n.id),{status:E,updatedAt:w}),r(q=>q.map(_=>_.id===n.id?{..._,status:E,updatedAt:F}:_)),d(null),j({title:`Meal Cycle ${E.charAt(0).toUpperCase()+E.slice(1)}`,description:`Your current meal cycle has been ${E}.`}),!0}catch(w){return console.error("Error marking meal cycle status:",w),!1}}catch(f){return console.error("Error in abandonMealCycle:",f),!1}};return{mealCycles:a,activeMealCycle:n,pendingMealCycle:i,loading:m,isOffline:c,error:v,isStartingMealCycle:D,startMealCycle:$,recordFirstBite:K,recordPostprandialReading:Z,abandonMealCycle:N,deleteMealCycle:async h=>{if(!s)return j({title:"Error",description:"You must be logged in to delete meal cycles.",variant:"destructive"}),!1;try{return await Ke(X(C,"mealCycles",h)),r(f=>f.filter(y=>y.id!==h)),j({title:"Success",description:"Meal cycle deleted successfully.",variant:"default"}),!0}catch(f){return console.error("Error deleting meal cycle:",f),j({title:"Error",description:"Failed to delete meal cycle.",variant:"destructive"}),!1}},clearAllSessions:async()=>{if(!s)return j({title:"Error",description:"You must be logged in to clear sessions.",variant:"destructive"}),!1;try{const h=h(C),f=Ne(C,"mealCycles"),y=_e(f,Ve("userId","==",s.uid));return(await st(y)).docs.forEach(M=>h.delete(M.ref)),await h.commit(),r([]),d(null),j({title:"Success",description:"All meal cycles have been deleted.",variant:"default"}),!0}catch(h){return console.error("Error clearing all sessions:",h),j({title:"Error",description:"Failed to clear all sessions.",variant:"destructive"}),!1}}}};let V=null,W=null;const ct=()=>{W&&(W.stop(),W=null),V&&(V.close(),V=null);try{V=new(window.AudioContext||window.webkitAudioContext),W=V.createOscillator();const t=V.createGain();W.type="sine",W.frequency.setValueAtTime(800,V.currentTime),t.gain.setValueAtTime(.5,V.currentTime),W.connect(t),t.connect(V.destination),W.start(),W.stop(V.currentTime+.5),W.onended=()=>{V&&(V.close(),V=null),W=null}}catch(t){console.error("Error playing notification sound:",t),W&&(W.stop(),W=null),V&&(V.close(),V=null)}},Kt=()=>"Notification"in window,Oa=()=>/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Da=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),La=async()=>{if(!Kt())return console.log("Notifications not supported in this browser"),!1;if(Oa()&&Da())return me({title:"Enable Notifications",description:"To receive alerts, please enable notifications in your Safari settings. Go to Settings > Safari > Notifications and allow notifications for this website.",duration:1e4,variant:"default"}),!1;try{return await Notification.requestPermission()==="granted"}catch(t){return console.error("Error requesting notification permission:",t),!1}},Ca=(t,s)=>{if(!Kt())return;const a={...s,icon:"/favicon.ico",badge:"/badge.png",vibrate:s.type==="readingDue"?[200,100,200]:s.type==="readingOverdue"?[200,100,200,100,200]:[200,100,200,100,200,100,200]},{type:r,...n}=a;Notification.permission==="granted"&&new Notification(t,n)},Zt=(t,s)=>{const{toast:a}=Fe(),[r,n]=l.useState(!1),[d,i]=l.useState(""),[o,m]=l.useState(""),[x,c]=l.useState(!1),[g,v]=l.useState({});l.useEffect(()=>{(async()=>{const j=await La();c(j)})()},[]);const p=l.useCallback((u,j,P=!1,D="readingDue")=>{P?(ct(),x&&Ca(u,{body:j,tag:"glucose-reading",renotify:!0,type:D}),m(u),i(j),n(!0)):a({title:u,description:j,duration:5e3})},[a,x]),b=l.useCallback(u=>{if(!(t!=null&&t.startTime))return{due:!1,overdue:!1,timeUntil:null};const j=Date.now(),D=t.startTime+u*60*1e3-j,A=Wt()*60*1e3,k=D<=0&&D>-A,$=D<=-A;return t.postprandialReadings[u]?{due:!1,overdue:!1,timeUntil:null}:{due:k,overdue:$,timeUntil:D>0?D:null}},[t==null?void 0:t.startTime,t==null?void 0:t.postprandialReadings]);return l.useEffect(()=>{if(!(t!=null&&t.startTime))return;const j=setInterval(()=>{const P=ge(s).readings;for(const D of P){if(t.postprandialReadings[D])continue;b(D).due&&!g[D]&&(ct(),v(k=>({...k,[D]:!0})))}},1e3);return()=>clearInterval(j)},[t,b,g,s]),{showNotification:p,getNotificationStatus:b,alertState:{isOpen:r,onClose:()=>n(!1),title:o,description:d}}},He={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyB8iporZmL1ioVMIrzfFEngzbBBGYjb4HU",VITE_FIREBASE_APP_ID:"1:87617577060:web:b06765cbffa87433e5ff71",VITE_FIREBASE_AUTH_DOMAIN:"newpeek-c5196.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-0CMN16ZBX8",VITE_FIREBASE_MESSAGING_SENDER_ID:"87617577060",VITE_FIREBASE_PROJECT_ID:"newpeek-c5196",VITE_FIREBASE_STORAGE_BUCKET:"newpeek-c5196.firebasestorage.app"},Pa=(He==null?void 0:He.VITE_APP_VERSION)||"dev",$a=()=>{const[t,s]=ae.useState(!navigator.onLine),{activeMealCycle:a}=he(),[r,n]=ae.useState(null);ae.useEffect(()=>{const i=()=>s(!1),o=()=>s(!0);return window.addEventListener("online",i),window.addEventListener("offline",o),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",o)}},[]),ae.useEffect(()=>{if(!(a!=null&&a.startTime)){n(null);return}const i=fe()*60*1e3,o=a.startTime+i,m=()=>{const c=Date.now(),g=o-c;n(g>0?g:0)};m();const x=setInterval(m,1e3);return()=>clearInterval(x)},[a==null?void 0:a.startTime]);const d=i=>{const o=Math.ceil(i/1e3),m=Math.floor(o/3600),x=Math.floor(o%3600/60),c=o%60;return m>0?`${m}h ${x}m ${c}s`:`${x}m ${c}s`};return e.jsx("footer",{className:"border-t py-4 mt-auto",children:e.jsxs("div",{className:"container flex justify-between items-center text-xs text-muted-foreground",children:[e.jsx("div",{children:e.jsx("span",{children:" 2025 PeekDiet"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[r!==null&&e.jsxs("div",{className:"flex items-center text-amber-500",children:[e.jsx(vt,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:["Cycle ends in ",d(r)]})]}),t&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(bt,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"Offline"})]}),e.jsxs("span",{children:["v",Pa]})]})]})})},Ga=({onStartAdhoc:t,onStartMeal:s})=>e.jsxs(B,{className:"w-full",children:[e.jsxs(U,{children:[e.jsx(H,{className:"text-center",children:"Track Your Glucose"}),e.jsx(J,{className:"text-center",children:"Monitor your blood glucose response to meals"})]}),e.jsx(z,{className:"flex flex-col items-center",children:e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"h-32 w-32 rounded-full bg-peekdiet-secondary flex items-center justify-center",children:e.jsx(Ds,{className:"h-16 w-16 text-peekdiet-primary"})})})}),e.jsxs(Re,{className:"flex flex-col space-y-2",children:[e.jsx(O,{onClick:s,className:"w-full",children:"Start Meal Cycle"}),e.jsx(O,{variant:"outline",onClick:t,className:"w-full",children:"Ad-hoc Reading"})]})]}),Xt=l.forwardRef(({className:t,trackColor:s="bg-primary",...a},r)=>e.jsxs(Nt,{ref:r,className:S("relative flex w-full touch-none select-none items-center",t),...a,children:[e.jsx(Ls,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Cs,{className:`absolute h-full ${s}`})}),e.jsx(Ps,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Xt.displayName=Nt.displayName;const ze=({timePoint:t,onSubmit:s,onAbandonCycle:a,onCompleteCycle:r,activeMealCycle:n=null,mode:d="testing"})=>{const[i,o]=l.useState(120),{toast:m}=Fe();he();const x=b=>{o(b[0])},c=()=>{o(Math.min(300,i+1))},g=()=>{o(Math.max(50,i-1))},v=()=>{const b=n?n.startTime+t*60*1e3:0,u=Date.now(),j=u<b-fe(d)*60*1e3,P=u>b+fe(d)*60*1e3;if(console.error("ðŸ©º SAVE READING DEBUG",{value:i,timePoint:t,activeMealCycle:!!n,postprandialReadings:n==null?void 0:n.postprandialReadings,expectedIntervals:ge(d).readings,cycleStatus:n==null?void 0:n.status,onSubmitType:typeof s,onAbandonCycleType:typeof a,isEarly:j,isLate:P,expectedTime:b,nowMillis:u}),i<50||i>300){m({title:"Invalid Value",description:"Please enter a glucose value between 50 and 300 mg/dL",variant:"destructive"});return}if(!s){console.error("âŒ CRITICAL: onSubmit is not defined!",{onSubmitFunction:s,componentProps:{value:i,timePoint:t,mode:d}}),m({title:"Submission Error",description:"Unable to save reading. Please contact support.",variant:"destructive"});return}if(n){const A=ge(d).readings,k=A[A.length-1],K=(Date.now()-n.startTime)/(60*1e3),Z=fe(d),N={currentTimePoint:t,lastInterval:k,intervals:A,postprandialReadings:n.postprandialReadings||{},isLastIntervalReading:t===k,hasAllReadings:A.every(h=>n.postprandialReadings&&n.postprandialReadings[h]!==void 0),minutesElapsed:K,cycleTimeout:Z};console.error("ðŸš¨ COMPLETION VERIFICATION:",JSON.stringify(N,null,2)),console.error("ðŸ” READING DETAILS:",A.map(h=>{var f,y;return{interval:h,hasReading:!!((f=n.postprandialReadings)!=null&&f[h]),reading:(y=n.postprandialReadings)==null?void 0:y[h]}}));const I=t===k,G=A.every(h=>n.postprandialReadings&&n.postprandialReadings[h]!==void 0);if(I||G){console.warn("ðŸ Meal Cycle Completion Triggered:",{reason:I?"Last interval reading":"All readings completed"}),m({title:"Meal Cycle Completed",description:"Your glucose tracking for this meal is now complete.",variant:"default"}),r==null||r();return}}(()=>{console.error("ðŸ“ READING SUBMISSION ATTEMPT",{timePoint:t,value:i,expectedIntervals:ge(d).readings,onSubmitFunction:!!s});const A=s(i);console.error("ðŸ“ READING SUBMISSION RESULT",{timePoint:t,value:i,submissionResult:A})})(),m({title:"Reading Recorded",description:`${i} mg/dL at ${t} minutes recorded successfully`})},p=()=>i<65?"text-blue-600":i<=90?"text-green-600":i<=105?"text-yellow-600":i<=140?"text-orange-600":i<=180?"text-red-600":"text-purple-600";return e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-center text-[3rem] font-bold mb-6 text-gray-800",children:"Glucose Reading"}),e.jsx("div",{className:"text-center mb-4",children:e.jsx("div",{className:"text-[2rem] text-center text-gray-600",children:i<65?e.jsx("span",{className:"text-blue-600",children:"Extreme Weight Loss"}):i<=90?e.jsx("span",{className:"text-green-600",children:"Weight Loss Range"}):i<=110?e.jsx("span",{className:"text-yellow-600",children:"Maintain Weight"}):i<=140?e.jsx("span",{className:"text-orange-600",children:"Weight Gain Range"}):i<=180?e.jsx("span",{className:"text-red-600",children:"Extreme Weight Gain"}):e.jsx("span",{className:"text-purple-600",children:"Extreme Weight Gain"})})}),e.jsx("div",{className:"text-center mb-4",children:e.jsxs("span",{className:`text-4xl font-bold ${p()}`,children:[i," mg/dL"]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(O,{variant:"outline",size:"icon",onClick:g,className:"h-10 w-10 rounded-full",children:e.jsx("span",{className:"text-[2.5rem]",children:"-"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Xt,{value:[i],min:50,max:300,step:1,onValueChange:x,className:"flex-1",trackColor:i<65?"bg-blue-500":i<=90?"bg-green-500":i<=110?"bg-yellow-500":i<=140?"bg-orange-500":i<=180?"bg-red-500":"bg-purple-500"})}),e.jsx(O,{variant:"outline",size:"icon",onClick:c,className:"h-10 w-10 rounded-full",children:e.jsx("span",{className:"text-[2.5rem]",children:"+"})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(O,{onClick:v,size:"lg",className:"mx-auto",children:"Save Reading"})})]})},Fa=({onFirstBite:t,preprandialValue:s,uniqueId:a})=>{const r=()=>{console.log("First bite button clicked"),t()};return e.jsxs(B,{className:"w-full",children:[e.jsxs(U,{children:[e.jsx(H,{className:"text-center",children:"Ready to Eat?"}),e.jsx(J,{className:"text-center",children:s?e.jsxs("span",{children:["We've recorded your preprandial reading of"," ",e.jsxs("span",{className:"font-semibold",children:[s," mg/dL"]}),a&&e.jsxs("div",{className:"mt-1 text-xs",children:["Meal Cycle ID: ",a.substring(0,8)]})]}):e.jsx("span",{children:"Let us know when you take your first bite"})})]}),e.jsx(z,{className:"flex justify-center",children:e.jsx("div",{className:"h-32 w-32 rounded-full bg-peekdiet-secondary flex items-center justify-center",children:e.jsx($s,{className:"h-16 w-16 text-peekdiet-primary"})})}),e.jsx(Re,{children:e.jsx(O,{onClick:r,className:"w-full text-lg py-6",size:"lg",children:"First Bite"})})]})},Jt=l.forwardRef(({className:t,value:s,...a},r)=>e.jsx(yt,{ref:r,className:S("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...a,children:e.jsx(Gs,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));Jt.displayName=yt.displayName;const Qt=({mealCycle:t})=>{console.log("[GlucoseGraph] Rendering with meal cycle:",{id:t.id,preprandial:t.preprandialReading,postprandial:t.postprandialReadings});const a=(()=>{const o=[];t.preprandialReading&&(console.log("[GlucoseGraph] Adding preprandial reading:",t.preprandialReading),o.push({name:"Pre",glucose:t.preprandialReading.value,time:0}));const m=Object.entries(t.postprandialReadings).sort(([x],[c])=>Number(x)-Number(c));return console.log("[GlucoseGraph] Sorted postprandial readings:",m),m.forEach(([x,c])=>{c&&c.value!==null&&c.value!==void 0&&(console.log(`[GlucoseGraph] Adding ${x}m reading:`,c),o.push({name:`${x}m`,glucose:c.value,time:Number(x)}))}),console.log("[GlucoseGraph] Final data array:",o),o})();if(a.length===0)return console.log("[GlucoseGraph] No data to display"),null;const r=Math.min(...a.map(o=>o.glucose)),n=Math.max(...a.map(o=>o.glucose)),d=10,i=[Math.max(0,r-d),n+d];return e.jsx(Me,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:a,margin:{top:5,right:5,left:5,bottom:5},children:[e.jsx(De,{strokeDasharray:"3 3",opacity:.2}),e.jsx(Le,{dataKey:"name",tick:{fontSize:10}}),e.jsx(Ce,{domain:i,tick:{fontSize:10}}),e.jsx(Pe,{formatter:o=>[`${o} mg/dL`,"Glucose"],labelFormatter:o=>o}),e.jsx($e,{type:"monotone",dataKey:"glucose",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6},connectNulls:!0})]})})},xe=t=>{const s=[t.preprandialReading,...Object.values(t.postprandialReadings)].filter(n=>n&&n.value!==null&&n.value!==void 0&&n.value>0);if(console.log("[calculateAverageGlucose] Valid readings:",s),console.log("[calculateAverageGlucose] Reading values:",s.map(n=>n.value)),s.length===0)return null;const a=s.reduce((n,d)=>n+d.value,0),r=Math.round(a/s.length);return console.log("[calculateAverageGlucose] Sum:",a),console.log("[calculateAverageGlucose] Count:",s.length),console.log("[calculateAverageGlucose] Average:",r),r},Qe=t=>{const s=[t.preprandialReading,...Object.values(t.postprandialReadings)].filter(a=>a&&a.value!==null&&a.value!==void 0&&a.value>0);return s.length===0?null:Math.max(...s.map(a=>a.value))},pe=t=>{if(!t||t===0)return"Not started";try{const s=typeof t=="number"?new Date(t):t instanceof Y?t.toDate():new Date(t);return isNaN(s.getTime())?(console.error("Invalid date:",t),"Not started"):s.toLocaleString("en-US",{timeZone:"America/New_York",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(s){return console.error("Error converting timestamp:",s),"Not started"}},Ba=({mealCycle:t,onTakeReading:s,onAbandon:a,mode:r="original"})=>{const[n,d]=l.useState(0),[i,o]=l.useState(null),{getNotificationStatus:m,alertState:x}=Zt(t,r),c=ge(r).readings,g=c[c.length-1],v=fe(r);l.useEffect(()=>{if(!(t!=null&&t.startTime))return;console.log("MealCycleTimer: Setting up timer with startTime",t.startTime);const N=()=>{const f=Date.now()-t.startTime;d(f);const y=I();o(y);const T=c[c.length-1];!!t.postprandialReadings[T]&&t.status!=="completed"&&a&&(console.log("Final reading completed. Automatically completing meal cycle."),a({status:"completed"}))},I=()=>{const h=c.filter(f=>!t.postprandialReadings[f]).sort((f,y)=>f-y);if(h.length===0)return null;for(const f of h){const y=m(f);if(!y.due&&!y.overdue)return{minutesMark:f,timeRemaining:y.timeUntil||0}}return null};N();const G=setInterval(N,1e3);return()=>clearInterval(G)},[t==null?void 0:t.startTime,t==null?void 0:t.postprandialReadings,t==null?void 0:t.status,m,c,r,a]);const p=()=>{const N=Math.floor(n/1e3),I=Math.floor(N/60),G=N%60;return`${I.toString().padStart(2,"0")}:${G.toString().padStart(2,"0")}`},b=N=>{const I=Math.ceil(N/1e3),G=Math.floor(I/60),h=I%60;return`${G.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}`},u=()=>{if(!(t!=null&&t.startTime))return 0;const N=n/1e3/60;return Math.min(N/g*100,100)},j=()=>{if(!i||i.timeRemaining<=0)return 100;const N=i.minutesMark,I=N*60*1e3-(N>c[0]?(N-c[0])*60*1e3:0),G=(I-i.timeRemaining)/I*100;return Math.min(G,100)},P=N=>{if(!(t!=null&&t.postprandialReadings)||t.postprandialReadings[N])return!1;const I=m(N);return I.due&&!I.overdue},D=N=>!(t!=null&&t.postprandialReadings)||t.postprandialReadings[N]?!1:m(N).overdue,A=N=>t!=null&&t.postprandialReadings?!!t.postprandialReadings[N]:!1,k=N=>{s(N)},$=()=>{!t||t.status==="abandoned"||(console.log("MealCycleTimer: Abandoning meal cycle"),a({status:"canceled"}))};if(t&&t.startTime&&(Date.now()-t.startTime)/(60*1e3)>=v)return t.status!=="abandoned"&&$(),null;if(!t)return e.jsx(B,{className:"w-full",children:e.jsxs(U,{children:[e.jsx(H,{children:"No Active Meal Cycle"}),e.jsx(J,{children:"Start a new meal cycle to begin tracking your glucose readings."})]})});const K=xe(t),Z=Qe(t);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full",children:e.jsxs(B,{className:"w-full",children:[e.jsx(U,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(H,{children:"Active Meal Cycle"}),e.jsxs(J,{children:[t.preprandialReading?`Preprandial reading taken at ${pe(t.preprandialReading.timestamp)}`:"No preprandial reading",t.status==="abandoned"&&e.jsx("span",{className:"text-destructive ml-2",children:"(Abandoned)"})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[K&&e.jsxs("span",{children:["Average: ",K," mg/dL"]}),Z&&e.jsxs("span",{className:"ml-4",children:["Peak: ",Z," mg/dL"]})]})]}),t.status!=="abandoned"&&e.jsx(O,{variant:"outline",size:"icon",className:"text-destructive hover:text-destructive/80",onClick:$,title:"Cancel meal cycle",children:e.jsx(Fs,{className:"h-6 w-6"})})]})}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"timer-circle h-24 w-24 rounded-full bg-muted flex items-center justify-center mb-2",children:e.jsx("div",{className:"text-2xl font-semibold text-foreground",children:t.startTime?p():"--:--"})}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.startTime?`First bite: ${pe(t.startTime)}`:"Awaiting first bite"})]}),e.jsx("div",{className:"w-full flex justify-between items-center text-xs text-muted-foreground mb-2",children:["FB",...c].map((N,I)=>{const G=I===0?se(t.startTime,"h:mma").replace("AM","a").replace("PM","p"):se(wt(t.startTime,Number(N)),"h:mma").replace("AM","a").replace("PM","p");return e.jsx("span",{className:"flex-1 text-center",children:G},N)})}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2.5",children:e.jsx("div",{className:"bg-peekdiet-primary h-2.5 rounded-full",style:{width:`${u()}%`}})}),i&&e.jsxs("div",{className:"mt-4 bg-accent/30 p-4 rounded-lg border border-accent",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"h-5 w-5 text-accent-foreground"}),e.jsx("span",{className:"text-base font-medium",children:i.timeRemaining>0?`Next reading in ${b(i.timeRemaining)}`:`${i.minutesMark}-minute reading due now!`})]}),e.jsxs("span",{className:"text-sm font-medium text-accent-foreground",children:[i.minutesMark," min"]})]}),e.jsx(Jt,{value:j(),className:"h-2"})]}),(t.preprandialReading||Object.keys(t.postprandialReadings).length>0)&&e.jsx("div",{className:"h-32 w-full mt-4",children:e.jsx(Qt,{mealCycle:t})}),e.jsx("div",{className:"grid grid-cols-3 gap-2 pt-4",children:c.map(N=>{let I="outline",G=`${N} min`,h=!P(N);return A(N)?(I="ghost",G=`${N} min âœ“`):P(N)?(I="default",G=`${N} min!`,h=!1):D(N)&&(I="ghost",G=`${N} min âœ—`),e.jsx(O,{variant:I,disabled:h,onClick:()=>k(N),className:`
                      ${A(N)?"text-muted-foreground":""}
                      ${D(N)?"text-destructive opacity-50":""}
                      ${P(N)?"animate-pulse":""}
                    `,children:G},N)})}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs mt-3",children:[e.jsx("div",{className:"text-muted-foreground text-right",children:"Pre:"}),e.jsx("div",{className:"font-semibold",children:t.preprandialReading?`${t.preprandialReading.value} mg/dL`:"â€”"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Peak:"}),e.jsx("div",{className:"font-semibold",children:Z?`${Z} mg/dL`:"â€”"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Readings:"}),e.jsx("div",{className:"font-semibold",children:Object.keys(t.postprandialReadings).length+(t.preprandialReading?1:0)}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Status:"}),e.jsx("div",{className:"font-semibold capitalize",children:t.status})]})]}),e.jsx(Re,{children:t.status!=="abandoned"&&e.jsx(O,{variant:"outline",onClick:()=>a({status:"canceled"}),className:"w-full hover:bg-red-100 hover:text-red-700",children:"Cancel Meal Cycle"})})]})})})},Ua=ke("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ha({className:t,variant:s,...a}){return e.jsx("div",{className:S(Ua({variant:s}),t),...a})}const za=({mealCycles:t,onSelect:s,onDeleteSession:a})=>{const{activeMealCycle:r}=he(),[n,d]=ae.useState(null);ae.useEffect(()=>{if(!(r!=null&&r.startTime)){d(null);return}const o=fe()*60*1e3,m=r.startTime+o,x=()=>{const g=Date.now(),v=m-g;d(v>0?v:0)};x();const c=setInterval(x,1e3);return()=>clearInterval(c)},[r==null?void 0:r.startTime]);const i=o=>{const m=Math.ceil(o/1e3),x=Math.floor(m/3600),c=Math.floor(m%3600/60),g=m%60;return x>0?`${x}h ${c}m ${g}s`:`${c}m ${g}s`};return t.length===0?e.jsx("div",{className:"text-center p-4",children:e.jsx("p",{className:"text-muted-foreground",children:"No meal cycles recorded yet."})}):e.jsxs("div",{className:"space-y-4",children:[n!==null&&e.jsxs("div",{className:"flex items-center justify-center text-amber-500",children:[e.jsx(vt,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:["Cycle ends in ",i(n)]})]}),e.jsx("h2",{className:"text-xl font-semibold",children:"Recent Meal Cycles"}),t.slice(0,2).map(o=>{var c;const m=xe(o),x=Qe(o);return e.jsxs(B,{className:"meal-card cursor-pointer",onClick:()=>s&&s(o.id),children:[e.jsx(U,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(H,{className:"text-lg",children:o.preprandialReading?pe(o.preprandialReading.timestamp):"No preprandial reading"}),e.jsxs(J,{children:["ID: ",o.uniqueId,m!==null&&e.jsxs("span",{className:"ml-2 font-semibold",children:["Average: ",m," mg/dL"]})]})]}),e.jsx(Ha,{variant:o.status==="completed"?"default":o.status==="active"?"outline":"secondary",children:o.status}),a&&o.status!=="active"&&e.jsx(O,{variant:"destructive",size:"sm",className:"ml-2",onClick:()=>a(o.id),children:"Delete"})]})}),e.jsxs(z,{children:[(o.status==="completed"||o.status==="abandoned"||Object.keys(o.postprandialReadings).length>0)&&e.jsx("div",{className:"h-32 w-full mt-2",children:e.jsx(Me,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:[{name:"Pre",glucose:(c=o.preprandialReading)==null?void 0:c.value},...Object.entries(o.postprandialReadings).sort(([g],[v])=>Number(g)-Number(v)).map(([g,v])=>({name:`${g}m`,glucose:v.value}))],margin:{top:5,right:5,left:5,bottom:5},children:[e.jsx(De,{strokeDasharray:"3 3",opacity:.2}),e.jsx(Le,{dataKey:"name",tick:{fontSize:10}}),e.jsx(Ce,{domain:["dataMin - 10","dataMax + 10"],tick:{fontSize:10}}),e.jsx(Pe,{formatter:g=>[`${g} mg/dL`,"Glucose"],labelFormatter:g=>g}),e.jsx($e,{type:"monotone",dataKey:"glucose",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})})}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs mt-3",children:[e.jsx("div",{className:"text-muted-foreground text-right",children:"Pre:"}),e.jsx("div",{className:"font-semibold",children:o.preprandialReading?`${o.preprandialReading.value} mg/dL`:"â€”"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Peak:"}),e.jsx("div",{className:"font-semibold",children:x?`${x} mg/dL`:"â€”"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Readings:"}),e.jsx("div",{className:"font-semibold",children:Object.keys(o.postprandialReadings).length+(o.preprandialReading?1:0)}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Status:"}),e.jsx("div",{className:"font-semibold capitalize",children:o.status})]})]})]},o.id)})]})},_a=zs,Va=Hs,es=l.forwardRef(({className:t,...s},a)=>e.jsx(Rt,{ref:a,className:S("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));es.displayName=Rt.displayName;const ts=l.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(Va,{children:[e.jsx(es,{}),e.jsxs(St,{ref:r,className:S("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a,children:[s,e.jsxs(Us,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ts.displayName=St.displayName;const Ya=l.forwardRef(({className:t,...s},a)=>e.jsx(At,{ref:a,className:S("text-lg font-semibold leading-none tracking-tight",t),...s}));Ya.displayName=At.displayName;const qa=l.forwardRef(({className:t,...s},a)=>e.jsx(Et,{ref:a,className:S("text-sm text-muted-foreground",t),...s}));qa.displayName=Et.displayName;const et=()=>{const{user:t}=ne(),[s,a]=l.useState([]),[r,n]=l.useState(!0),[d,i]=l.useState(null);return l.useEffect(()=>{if(!t){n(!1);return}console.log("Setting up ad hoc readings listener...");const x=_e(Ne(C,"adHocReadings"),Ve("userId","==",t.uid)),c=_s(x,g=>{console.log("Received ad hoc readings snapshot:",g.size,"documents");const v=[];g.forEach(p=>{const b=p.data(),u=b.timestamp instanceof Y?b.timestamp.toMillis():b.timestamp;console.log("Reading data:",{id:p.id,...b,timestamp:u}),v.push({id:p.id,...b,timestamp:u})}),v.sort((p,b)=>b.timestamp-p.timestamp),console.log("Processed readings:",v),a(v),n(!1)},g=>{console.error("Error fetching ad hoc readings:",g),i(g),n(!1)});return()=>{console.log("Cleaning up ad hoc readings listener"),c()}},[t]),{adHocReadings:s,loading:r,error:d,createAdHocReading:async x=>{if(!t)throw new Error("User must be authenticated to create ad hoc readings");try{const c=Y.now(),g={userId:t.uid,value:x,timestamp:c,type:"adhoc",createdAt:c,updatedAt:c};return{id:(await jt(Ne(C,"adHocReadings"),g)).id,...g,timestamp:c.toMillis()}}catch(c){throw console.error("Error creating ad hoc reading:",c),c}},deleteAdHocReading:async x=>{if(!t)return me({title:"Error",description:"You must be logged in to delete readings.",variant:"destructive"}),!1;try{return await Ke(X(C,"adHocReadings",x)),a(c=>c.filter(g=>g.id!==x)),me({title:"Success",description:"Ad hoc reading deleted successfully.",variant:"default"}),!0}catch(c){return console.error("Error deleting ad hoc reading:",c),me({title:"Error",description:"Failed to delete ad hoc reading.",variant:"destructive"}),!1}}}},Wa={original:{firstBite:0,readings:[20,40,60,90,120,180]},testing:{firstBite:0,readings:[3,6,9,12,15,18]}};function ss(t="testing"){return Wa[t]}const ut=()=>{const{loading:t}=ne(),{mealCycles:s,activeMealCycle:a,startMealCycle:r,recordFirstBite:n,recordPostprandialReading:d,abandonMealCycle:i,deleteMealCycle:o,clearAllSessions:m,isOffline:x,pendingMealCycle:c,error:g,isStartingMealCycle:v}=he();Zt(a);const{createAdHocReading:p}=et(),[b,u]=l.useState("idle"),[j,P]=l.useState(null),[D,A]=l.useState(!1),[k,$]=l.useState();if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})});l.useEffect(()=>(console.error("Dashboard mounted at:",new Date().toISOString()),a?console.log("Active meal cycle:",{id:a.id,startTime:a.startTime,preprandial:a.preprandialReading,status:a.status}):console.log("No active meal cycle"),c&&console.log("Pending meal cycle:",c),()=>{console.error("Dashboard unmounted at:",new Date().toISOString())}),[a,c]),l.useEffect(()=>{const R=a||c;if(R)try{const L=ss("testing").readings,Q=R.postprandialReadings||{},oe=L.every(le=>Q[le]!==void 0);console.error("ðŸš¨ ABANDONMENT DEBUG",{activeMealCycle:!!R,onAbandonCycle:typeof A,shouldAbandon:oe,postprandialReadings:Object.keys(Q),expectedIntervals:L,cycleStatus:R.status,readingsDetails:L.map(le=>({interval:le,hasReading:Q[le]!==void 0,reading:Q[le]}))})}catch(L){console.error("Error in abandonment debug:",L)}},[a,c]),l.useEffect(()=>{console.log("ðŸš¨ DASHBOARD: modalStatus changed",{modalStatus:k})},[k]);const K=()=>{u("preprandial")},Z=()=>{u("adhoc")},N=async R=>{console.log("Starting meal cycle with preprandial value:",R),await r(R),u("idle"),console.log("Input mode reset to idle after starting meal cycle")},I=()=>{console.log("Recording first bite"),n()},G=R=>{P(R),u("postprandial")},h=R=>{j!==null&&d(j,R),u("idle"),P(null)},f=async R=>{try{await p(R),me({title:"Ad-hoc reading saved",description:"Your blood glucose reading has been recorded."}),u("idle")}catch(L){console.error("Error saving ad-hoc reading:",L),me({title:"Error saving reading",description:L instanceof Error?L.message:"Unknown error",variant:"destructive"})}},y=async()=>{console.log("ðŸš¨ Handling Abandon Confirm",{currentActiveMealCycle:a,currentModalStatus:k});try{$("canceled"),await i({status:"canceled",newVar:"Hello World"})?(console.log("ðŸš¨ Meal Cycle Successfully Canceled"),A(!1),$(void 0)):console.error("ðŸš¨ Failed to Cancel Meal Cycle")}catch(R){console.error("ðŸš¨ Error in Abandoning Meal Cycle:",R)}},T=async()=>{await i({status:"completed"})&&A(!1)},M=async R=>{await o(R)},E=async()=>{await m()},w=R=>{const L=()=>{console.log("ðŸš¨ Closing Modal"),A(!1),$(void 0)},Q=()=>{R==="active"?(console.log("ðŸš¨ Confirmed Meal Cycle Cancellation"),y()):L()};return e.jsx("div",{className:"flex justify-center w-full p-2",children:e.jsx(O,{variant:"default",onClick:Q,className:"w-20 h-10",children:"OK"})})},F=()=>x?e.jsxs(B,{className:"mb-4 border-destructive bg-destructive/10",children:[e.jsx(U,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"h-5 w-5 text-destructive"}),e.jsx(H,{className:"text-base text-destructive",children:"Offline Mode"})]})}),e.jsx(z,{children:e.jsx(J,{className:"text-destructive/90",children:"You're currently offline. Some features will be limited until your connection is restored. Your data will sync when you're back online."})})]}):null,q=()=>{var L;if(b==="preprandial")return e.jsx(ze,{title:"Preprandial Reading",description:"Enter your blood glucose before eating",onSubmit:N,onCancel:()=>u("idle"),isLoading:v,onAbandonCycle:()=>A(!0)});if(b==="postprandial")return e.jsx(ze,{title:`${j}-Minute Reading`,description:`Enter your blood glucose ${j} minutes after first bite`,onSubmit:h,onCancel:()=>u("idle"),onAbandonCycle:()=>A(!0)});if(b==="adhoc")return e.jsx(ze,{title:"Ad-hoc Reading",description:"Enter your current blood glucose",onSubmit:f,onCancel:()=>u("idle"),onAbandonCycle:()=>A(!0)});const R=a||c;return R?!R.startTime||R.startTime===0?e.jsx("div",{className:"w-full",children:e.jsx(Fa,{onFirstBite:I,preprandialValue:(L=R.preprandialReading)==null?void 0:L.value,uniqueId:R.uniqueId})}):e.jsx("div",{className:"w-full",children:e.jsx(Ba,{mealCycle:R,onTakeReading:G,onAbandon:()=>A(!0),onComplete:T,onAbandonConfirm:()=>A(!0)})}):e.jsx(Ga,{onStartAdhoc:Z,onStartMeal:K})},_=()=>(console.log("ðŸš¨ Rendering Abandon Confirm Dialog",{showAbandonConfirm:D,modalStatus:k,activeMealCycleStatus:a==null?void 0:a.status}),e.jsx(_a,{open:D,onOpenChange:R=>{R||$(void 0),A(R)},children:e.jsx(ts,{className:"sm:max-w-[200px] max-w-[180px]",onInteractOutside:R=>{R.preventDefault()},children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Continue"}),w(a==null?void 0:a.status)]})})}));return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("main",{className:"flex-1 container max-w-md mx-auto p-4",children:e.jsxs("div",{className:"space-y-6",children:[F(),q(),g&&e.jsx(B,{className:"border-destructive bg-destructive/10 mt-4",children:e.jsx(z,{className:"pt-4",children:e.jsxs("p",{className:"text-destructive text-sm",children:[e.jsx(Vs,{className:"h-4 w-4 inline mr-1"}),g]})})}),s.length>0&&b==="idle"&&e.jsxs("div",{children:[e.jsx(za,{mealCycles:s,onDeleteSession:M}),e.jsx(O,{variant:"destructive",onClick:E,className:"w-full h-10 mt-4",children:"Clear All Sessions"})]})]})}),e.jsx($a,{}),_()]})},Ka=()=>{const{id:t}=Ys(),{mealCycles:s,loading:a,error:r}=he(),[n,d]=l.useState(null);return l.useEffect(()=>{if(t&&s.length>0){const i=s.find(o=>o.id===t);d(i||null)}},[t,s]),a?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(B,{className:"max-w-md w-full",children:[e.jsx(U,{children:e.jsxs(H,{className:"text-red-500 flex items-center gap-2",children:[e.jsx(qs,{className:"h-5 w-5"}),"Error"]})}),e.jsx(z,{children:e.jsx("p",{className:"text-gray-600",children:r})})]})}):n?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs(B,{className:"mb-6",children:[e.jsxs(U,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"h-5 w-5"}),"Meal Cycle Details"]}),e.jsx(J,{children:n.preprandialReading?`Preprandial reading taken at ${pe(n.preprandialReading.timestamp)}`:"No preprandial reading"})]}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("p",{className:"font-medium capitalize",children:n.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Unique ID"}),e.jsx("p",{className:"font-medium",children:n.uniqueId})]})]}),n.preprandialReading&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Preprandial Reading"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Value"}),e.jsxs("p",{className:"font-medium",children:[n.preprandialReading.value," mg/dL"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Time"}),e.jsx("p",{className:"font-medium",children:pe(n.preprandialReading.timestamp)})]})]})]}),Object.keys(n.postprandialReadings).length>0&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Postprandial Readings"}),e.jsx("div",{className:"space-y-4",children:Object.entries(n.postprandialReadings).sort(([i],[o])=>Number(i)-Number(o)).map(([i,o])=>e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[i," minutes"]}),e.jsxs("p",{className:"font-medium",children:[o.value," mg/dL"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Time"}),e.jsx("p",{className:"font-medium",children:pe(o.timestamp)})]})]},o.id))})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(O,{variant:"outline",onClick:()=>window.history.back(),children:"Back to Dashboard"})})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(B,{className:"max-w-md w-full",children:[e.jsx(U,{children:e.jsx(H,{children:"Meal Cycle Not Found"})}),e.jsx(z,{children:e.jsx("p",{className:"text-gray-600",children:"The requested meal cycle could not be found."})})]})})},as=l.forwardRef(({className:t,...s},a)=>e.jsx(kt,{className:S("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:a,children:e.jsx(Ws,{className:S("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));as.displayName=kt.displayName;const Za=()=>{const{user:t,logout:s}=ne(),[a,r]=l.useState(!0),[n,d]=l.useState("mg/dL"),i=async()=>{try{await s()}catch(o){console.error("Error logging out:",o)}};return t?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(B,{className:"max-w-2xl mx-auto",children:[e.jsxs(U,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),"Profile Settings"]}),e.jsx(J,{children:"Manage your account settings and preferences"})]}),e.jsxs(z,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{htmlFor:"email",children:"Email"}),e.jsx(we,{id:"email",type:"email",value:t.email||"",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{htmlFor:"displayName",children:"Display Name"}),e.jsx(we,{id:"displayName",type:"text",value:t.displayName||"",disabled:!0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(ue,{children:"Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive alerts for meal cycle readings"})]}),e.jsx(as,{checked:a,onCheckedChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{children:"Glucose Unit"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(O,{variant:n==="mg/dL"?"default":"outline",onClick:()=>d("mg/dL"),children:"mg/dL"}),e.jsx(O,{variant:n==="mmol/L"?"default":"outline",onClick:()=>d("mmol/L"),children:"mmol/L"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(O,{variant:"outline",className:"w-full",onClick:i,children:[e.jsx(It,{className:"h-4 w-4 mr-2"}),"Log Out"]})})]})]})}):null},mt=t=>t<65?"text-blue-600":t<=90?"text-green-600":t<=105?"text-yellow-600":t<=140?"text-orange-600":t<=180?"text-red-600":"text-purple-600",Xa=({mealCycles:t,adHocReadings:s=[]})=>{const a=ae.useMemo(()=>{const i={};return t.forEach(o=>{if(o.preprandialReading){const m=new Date(o.preprandialReading.timestamp).toDateString();i[m]||(i[m]=[]),i[m].push(o)}}),i},[t]),r=i=>{const o=i.map(xe).filter(m=>m!==null);return o.length>0?o.reduce((m,x)=>m+x,0)/o.length:null},n=ae.useMemo(()=>Object.entries(a).map(([i,o])=>{const m=r(o);return{name:se(new Date(i),"MM/dd"),glucose:m!==null?Number(m.toFixed(1)):null}}).filter(i=>i.glucose!==null).sort((i,o)=>new Date(i.name).getTime()-new Date(o.name).getTime()),[a]),d=ae.useMemo(()=>{const i=Object.entries(a).map(([o,m])=>r(m)).filter(o=>o!==null);return i.length>0?i.reduce((o,m)=>o+m,0)/i.length:null},[a]);return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Glucose History"}),e.jsx(at,{allowZeroExpanded:!0,children:e.jsxs(nt,{uuid:"running-average",children:[e.jsx(rt,{children:e.jsx(it,{className:"bg-white p-4 border-b hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Running Average"}),d!==null&&e.jsxs("span",{className:`font-bold ${mt(d)}`,children:[d.toFixed(1)," mg/dL"]})]})})}),e.jsx(ot,{className:"p-4 bg-gray-50",children:e.jsx("div",{className:"w-full h-64",children:e.jsx(Me,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:n,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(De,{strokeDasharray:"3 3",opacity:.2}),e.jsx(Le,{dataKey:"name"}),e.jsx(Ce,{domain:["dataMin - 10","dataMax + 10"],label:{value:"Glucose (mg/dL)",angle:-90,position:"insideLeft"}}),e.jsx(Pe,{formatter:i=>[`${i} mg/dL`,"Daily Average"],labelFormatter:i=>`Date: ${i}`}),e.jsx($e,{type:"monotone",dataKey:"glucose",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})})})})]})}),e.jsx(at,{allowZeroExpanded:!0,children:Object.entries(a).map(([i,o])=>{const m=r(o);return e.jsxs(nt,{uuid:i,children:[e.jsx(rt,{children:e.jsx(it,{className:"bg-white p-4 border-b hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold",children:i}),m!==null&&e.jsxs("span",{className:`font-bold ${mt(m)}`,children:[m.toFixed(1)," mg/dL"]})]})})}),e.jsx(ot,{className:"p-4 bg-gray-50",children:e.jsx("div",{className:"space-y-4",children:o.map(x=>{var c,g;return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{children:pe((c=x.preprandialReading)==null?void 0:c.timestamp)}),xe(x)!==null&&e.jsxs("span",{className:"font-semibold",children:["Avg: ",(g=xe(x))==null?void 0:g.toFixed(1)," mg/dL"]})]}),e.jsx("div",{className:"h-40 w-full",children:e.jsx(Qt,{mealCycle:x})})]},x.id)})})})]},i)})})]})},Ja=()=>{const{mealCycles:t,loading:s,error:a}=he(),{adHocReadings:r,loading:n,error:d}=et();if(l.useEffect(()=>(console.error("History mounted at:",new Date().toISOString()),()=>{console.error("History unmounted at:",new Date().toISOString())}),[]),s||n)return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-peekdiet-secondary"}),e.jsx("div",{className:"mt-4 h-4 w-32 bg-muted rounded"})]})})});if(a||d)return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container max-w-md mx-auto p-4",children:e.jsx("div",{className:"flex items-center gap-2 text-destructive",children:e.jsx("p",{className:"text-sm",children:a||(d==null?void 0:d.message)})})})});const i=t.filter(o=>["completed","abandoned","canceled"].includes(o.status));return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("main",{className:"container max-w-2xl mx-auto p-4",children:e.jsx(Xa,{mealCycles:i,adHocReadings:r})})})},Qa=({reading:t})=>e.jsxs(B,{className:"opacity-90",children:[e.jsxs(U,{children:[e.jsx(H,{children:se(t.timestamp,"PPP p")}),e.jsx(J,{children:"Ad Hoc Reading"})]}),e.jsx(z,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs",children:[e.jsx("div",{className:"text-muted-foreground text-right",children:"Value:"}),e.jsxs("div",{className:"font-semibold",children:[t.value," mg/dL"]}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Type:"}),e.jsx("div",{className:"font-semibold capitalize",children:t.type})]})})]}),en=()=>{const{mealCycles:t,loading:s,deleteMealCycle:a}=he(),{adHocReadings:r,loading:n,error:d,deleteAdHocReading:i}=et(),o=async g=>{await a(g)&&console.log(`Meal cycle ${g} deleted successfully`)},m=async g=>{await i(g)&&console.log(`Ad hoc reading ${g} deleted successfully`)};console.log("MealSessions - Ad Hoc Readings:",{count:r.length,readings:r,loading:n,error:d});const x=l.useMemo(()=>{console.log("Grouping readings...");const g={};return t.forEach(v=>{const p=se(v.startTime,"yyyy-MM-dd");g[p]||(g[p]={date:new Date(v.startTime),mealCycles:[],adHocReadings:[],dailyAverage:null}),g[p].mealCycles.push(v)}),r.forEach(v=>{console.log("Processing ad hoc reading:",v);const p=se(v.timestamp,"yyyy-MM-dd");g[p]||(g[p]={date:new Date(v.timestamp),mealCycles:[],adHocReadings:[],dailyAverage:null}),g[p].adHocReadings.push(v)}),Object.values(g).forEach(v=>{const p=[...v.mealCycles.flatMap(b=>[b.preprandialReading,...Object.values(b.postprandialReadings)]),...v.adHocReadings].filter(b=>b&&b.value!==null&&b.value!==void 0&&b.value>0);if(p.length>0){const b=p.reduce((u,j)=>u+j.value,0);v.dailyAverage=Math.round(b/p.length)}}),console.log("Grouped readings:",g),g},[t,r]),c=l.useMemo(()=>Object.values(x).sort((g,v)=>v.date.getTime()-g.date.getTime()),[x]);return s||n?e.jsx("div",{children:"Loading..."}):d?(console.error("Error with ad hoc readings:",d),e.jsxs("div",{children:["Error loading ad hoc readings: ",d.message]})):e.jsx("div",{className:"space-y-8 px-[2rem]",children:c.map(({date:g,mealCycles:v,adHocReadings:p,dailyAverage:b})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:se(g,"PPP")}),b!==null&&e.jsxs("span",{className:"text-lg font-semibold",children:["Daily Average: ",b," mg/dL"]})]}),e.jsxs("div",{className:"space-y-4",children:[v.map(u=>{var A;const j=xe(u),P=Qe(u),D=ss("original").readings;return e.jsxs(B,{className:"relative",children:[["completed","canceled","abandoned"].includes(u.status)&&e.jsx(O,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-10",onClick:()=>o(u.id),children:e.jsx(lt,{className:"h-4 w-4 text-destructive"})}),e.jsxs(U,{children:[e.jsx(H,{children:se(u.startTime,"p")}),e.jsxs(J,{children:["ID: ",u.uniqueId,j!==null&&e.jsxs("span",{className:"ml-2 font-semibold",children:["Average: ",j," mg/dL"]})]})]}),e.jsxs(z,{children:[(u.status==="completed"||u.status==="abandoned"||Object.keys(u.postprandialReadings).length>0)&&e.jsxs("div",{className:"h-32 w-full mt-2",children:[e.jsx("div",{className:"w-full flex justify-between items-center text-xs text-gray-500 mb-2",children:["FB",...D].map((k,$)=>{const K=$===0?se(u.startTime,"h:mma"):se(wt(u.startTime,Number(k)),"h:mma");return e.jsx("span",{className:"flex-1 text-center",children:K},k)})}),e.jsx(Me,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:[{name:"Pre",glucose:(A=u.preprandialReading)==null?void 0:A.value},...Object.entries(u.postprandialReadings).sort(([k],[$])=>Number(k)-Number($)).map(([k,$])=>({name:`${k}m`,glucose:$.value}))],margin:{top:5,right:5,left:5,bottom:5},children:[e.jsx(De,{strokeDasharray:"3 3",opacity:.2}),e.jsx(Le,{dataKey:"name",tick:{fontSize:10}}),e.jsx(Ce,{domain:["dataMin - 10","dataMax + 10"],tick:{fontSize:10}}),e.jsx(Pe,{formatter:k=>[`${k} mg/dL`,"Glucose"],labelFormatter:k=>k}),e.jsx($e,{type:"monotone",dataKey:"glucose",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs mt-3",children:[e.jsx("div",{className:"text-muted-foreground text-right",children:"Pre:"}),e.jsx("div",{className:"font-semibold",children:u.preprandialReading?`${u.preprandialReading.value} mg/dL`:"â€”"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Peak:"}),e.jsx("div",{className:"font-semibold",children:P?`${P} mg/dL`:"â€”"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Readings:"}),e.jsx("div",{className:"font-semibold",children:Object.keys(u.postprandialReadings).length+(u.preprandialReading?1:0)}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Status:"}),e.jsx("div",{className:"font-semibold capitalize",children:u.status})]})]})]},u.id)}),p.map(u=>e.jsxs(B,{className:"relative",children:[e.jsx(O,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-10",onClick:()=>m(u.id),children:e.jsx(lt,{className:"h-4 w-4 text-destructive"})}),e.jsx(Qa,{reading:u})]},u.id))]})]},g.toISOString()))})},tn=()=>(l.useEffect(()=>(console.error("TrackGlucose mounted at:",new Date().toISOString()),()=>{console.error("TrackGlucose unmounted at:",new Date().toISOString())}),[]),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Track Glucose"}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx("p",{children:"Glucose tracking functionality coming soon..."})})]})),sn=()=>{const t=Ze();return l.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},ns=l.forwardRef(({className:t,...s},a)=>e.jsx(Mt,{ref:a,className:S("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));ns.displayName=Mt.displayName;const rs=l.forwardRef(({className:t,...s},a)=>e.jsx(Ot,{ref:a,className:S("aspect-square h-full w-full",t),...s}));rs.displayName=Ot.displayName;const is=l.forwardRef(({className:t,...s},a)=>e.jsx(Dt,{ref:a,className:S("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));is.displayName=Dt.displayName;const an=Qs,nn=ea,rn=l.forwardRef(({className:t,inset:s,children:a,...r},n)=>e.jsxs(Lt,{ref:n,className:S("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",t),...r,children:[a,e.jsx(Ks,{className:"ml-auto h-4 w-4"})]}));rn.displayName=Lt.displayName;const on=l.forwardRef(({className:t,...s},a)=>e.jsx(Ct,{ref:a,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s}));on.displayName=Ct.displayName;const os=l.forwardRef(({className:t,sideOffset:s=4,...a},r)=>e.jsx(Zs,{children:e.jsx(Pt,{ref:r,sideOffset:s,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}));os.displayName=Pt.displayName;const Te=l.forwardRef(({className:t,inset:s,...a},r)=>e.jsx($t,{ref:r,className:S("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",t),...a}));Te.displayName=$t.displayName;const ln=l.forwardRef(({className:t,children:s,checked:a,...r},n)=>e.jsxs(Gt,{ref:n,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:a,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ft,{children:e.jsx(Xs,{className:"h-4 w-4"})})}),s]}));ln.displayName=Gt.displayName;const dn=l.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(Bt,{ref:r,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ft,{children:e.jsx(Js,{className:"h-2 w-2 fill-current"})})}),s]}));dn.displayName=Bt.displayName;const ls=l.forwardRef(({className:t,inset:s,...a},r)=>e.jsx(Ut,{ref:r,className:S("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...a}));ls.displayName=Ut.displayName;const We=l.forwardRef(({className:t,...s},a)=>e.jsx(Ht,{ref:a,className:S("-mx-1 my-1 h-px bg-muted",t),...s}));We.displayName=Ht.displayName;const cn="/assets/banner-B7g7NXf4.png",un=()=>{var o;const t=Ze(),{user:s,logout:a}=ne(),[r,n]=l.useState(!1),d=m=>t.pathname===m||m==="/dashboard"&&t.pathname==="/",i=[{path:"/dashboard",icon:na,label:"Dashboard"},{path:"/history",icon:ra,label:"History"},{path:"/sessions",icon:Tt,label:"Sessions"},{path:"/track",icon:ia,label:"Track Glucose"},{path:"/about",icon:oa,label:"About"},{path:"/profile",icon:Ye,label:"Profile"}];return e.jsxs("nav",{className:"bg-white shadow-sm",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16 items-center",children:[t.pathname!=="/login"&&e.jsx("div",{className:"flex items-center",children:e.jsx(O,{variant:"ghost",size:"icon",onClick:()=>n(!r),className:"text-gray-500 hover:text-gray-700",children:r?e.jsx(Ie,{className:"h-20 w-20 sm:h-24 sm:w-24 md:h-28 md:w-28 stroke-[3] text-gray-500 hover:text-gray-700"}):e.jsx(ta,{className:"h-20 w-20 sm:h-24 sm:w-24 md:h-28 md:w-28 stroke-[3] text-gray-500 hover:text-gray-700"})})}),e.jsx("div",{className:"flex-grow flex justify-center items-center",children:e.jsx("img",{src:cn,alt:"PeekDiet Banner",className:"max-h-10 max-w-[200px] object-contain"})}),e.jsx("div",{className:"flex items-center",children:s?e.jsxs(an,{children:[e.jsx(nn,{asChild:!0,children:e.jsx(O,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:e.jsxs(ns,{className:"h-8 w-8",children:[e.jsx(rs,{src:s.photoURL||void 0,alt:s.displayName||"User"}),e.jsx(is,{children:((o=s.displayName)==null?void 0:o.charAt(0))||"U"})]})})}),e.jsxs(os,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(ls,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:s.displayName}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:s.email})]})}),e.jsx(We,{}),e.jsxs(Te,{children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Profile"})]}),e.jsxs(Te,{children:[e.jsx(sa,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Settings"})]}),e.jsx(We,{}),e.jsxs(Te,{onClick:()=>a(),children:[e.jsx(It,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]}):null})]})}),t.pathname!=="/login"&&r&&e.jsx("div",{className:"block",children:e.jsx("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3",children:i.map(m=>e.jsx(aa,{to:m.path,className:`block px-3 py-2 rounded-md text-base font-medium ${d(m.path)?"bg-peekdiet-primary text-white":"text-gray-500 hover:bg-gray-50 hover:text-gray-700"}`,onClick:()=>n(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(m.icon,{className:"h-5 w-5 mr-2"}),m.label]})},m.path))})})]})},ds=l.forwardRef(({className:t,orientation:s="horizontal",decorative:a=!0,...r},n)=>e.jsx(zt,{ref:n,decorative:a,orientation:s,className:S("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...r}));ds.displayName=zt.displayName;const mn=()=>e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8 text-center",children:"Metabolic Tracking: Your Personal Health Insights"}),e.jsxs(B,{className:"mb-8",children:[e.jsx(U,{children:e.jsx(H,{children:"Why This App is a Game-Changer for Personal Health"})}),e.jsxs(z,{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Structured Testing = Clamp-Like Rigor"}),e.jsxs("ul",{className:"list-disc pl-6 mb-6",children:[e.jsxs("li",{children:["The ",e.jsx("strong",{children:"6 readings over 3 hours"})," mirror the frequency of research-grade clamp studies, capturing:"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"First-phase insulin response"})," (30â€“60 mins post-meal)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Second-phase insulin action"})," (2â€“3 hours post-meal)"]}),e.jsxs("li",{children:["Unlike sporadic testing, this protocol detects ",e.jsx("strong",{children:"delayed glucose clearance"})," (a hallmark of insulin resistance)"]})]})]})]}),e.jsxs(B,{className:"mb-8",children:[e.jsx(U,{children:e.jsx(H,{children:"Who Should Use It?"})}),e.jsx(z,{children:e.jsxs("ul",{className:"list-disc pl-6",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Prediabetics/Diabetics"}),": Catch post-meal spikes masked by normal fasting glucose"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Biohackers"}),": Optimize diets for metabolic flexibility"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Athletes"}),": Fine-tune carb tolerance for performance"]}),e.jsxs("li",{children:[e.jsx("strong",{children:'Anyone with "Unexplained" Fatigue/Brain Fog'}),": Hidden hyperglycemia could be the culprit"]})]})})]}),e.jsxs(B,{className:"mb-8",children:[e.jsx(U,{children:e.jsx(H,{children:"How to Get the Most Out of It"})}),e.jsxs(z,{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Test 3â€“5 Signature Meals"}),e.jsxs("ul",{className:"list-disc pl-6 mb-6",children:[e.jsx("li",{children:"High-carb (e.g., rice)"}),e.jsx("li",{children:"High-fat (e.g., avocado + nuts)"}),e.jsx("li",{children:"Mixed (e.g., pizza)"})]}),e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Intervene Based on Data"}),e.jsxs("ul",{className:"list-disc pl-6",children:[e.jsx("li",{children:"If glucose >140 mg/dL at 1 hour â†’ try vinegar before meals or walking post-meal"}),e.jsx("li",{children:"If glucose stays high at 3 hours â†’ reduce carb portion size"})]})]})]}),e.jsx(ds,{className:"my-8"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Final Verdict"}),e.jsxs("p",{className:"text-lg mb-6",children:["This app is ",e.jsx("strong",{children:"one of the best practical tools"})," for metabolic self-awareness outside a lab. While not a true clamp, it brings ",e.jsx("strong",{children:"scientific methodology to personal health"}),"â€”letting users detect dysfunction early and intervene."]}),e.jsxs("p",{className:"text-lg font-semibold",children:["Recommendation: Use it alongside ",e.jsx("strong",{children:"fasting insulin tests"})," and ",e.jsx("strong",{children:"ketone monitoring"}),". For proactive individuals, this is a ",e.jsx("strong",{children:"no-brainer"}),"."]})]})]});function gn(){return e.jsx(la,{children:e.jsx(ja,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(un,{}),e.jsxs(da,{children:[e.jsx(ee,{path:"/login",element:e.jsx(Ia,{})}),e.jsx(ee,{path:"/",element:e.jsx(ie,{children:e.jsx(ut,{})})}),e.jsx(ee,{path:"/dashboard",element:e.jsx(ie,{children:e.jsx(ut,{})})}),e.jsx(ee,{path:"/history",element:e.jsx(ie,{children:e.jsx(Ja,{})})}),e.jsx(ee,{path:"/sessions",element:e.jsx(ie,{children:e.jsx(en,{})})}),e.jsx(ee,{path:"/track",element:e.jsx(ie,{children:e.jsx(tn,{})})}),e.jsx(ee,{path:"/meal-cycle/:id",element:e.jsx(ie,{children:e.jsx(Ka,{})})}),e.jsx(ee,{path:"/profile",element:e.jsx(ie,{children:e.jsx(Za,{})})}),e.jsx(ee,{path:"/about",element:e.jsx(ie,{children:e.jsx(mn,{})})}),e.jsx(ee,{path:"*",element:e.jsx(sn,{})})]}),e.jsx(ba,{})]})})})}ca(document.getElementById("root")).render(e.jsx(gn,{}));
