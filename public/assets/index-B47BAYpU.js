var ps=Object.defineProperty;var hs=(t,s,a)=>s in t?ps(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var re=(t,s,a)=>hs(t,typeof s!="symbol"?s+"":s,a);import{i as fs,P as xs,g as js,a as vs,b as bs,c as Ns,G as xt,d as jt,r as d,u as vt,o as ys,j as e,s as at,e as ws,f as nt,h as Rs,W as Ss,k as J,l as As,m as Es,n as be,y as Xe,p as Je,N as Ts,t as ks,q as Is,L as bt,T as Nt,C as yt,R as Ms,v as Ie,S as Os,X as Re,w as wt,x as Ds,M as Ls,z as Ve,_ as Ne,A as _e,B as rt,D as Y,E as Rt,F as ne,H as St,I as At,J as Ps,K as Et,O as Cs,Q as Gs,U as $s,V as Fs,Y as Tt,Z as Bs,$ as Me,a0 as Oe,a1 as De,a2 as Le,a3 as Pe,a4 as Ce,a5 as Ge,a6 as zs,a7 as se,a8 as kt,a9 as Hs,aa as It,ab as Mt,ac as Us,ad as Ot,ae as Dt,af as Vs,ag as _s,ah as Ys,ai as Ws,aj as qs,ak as Ks,al as Lt,am as Pt,an as Zs,ao as Ye,ap as Ct,aq as it,ar as ot,as as lt,at as dt,au as ct,av as ut,aw as Gt,ax as $t,ay as Ft,az as Bt,aA as Xs,aB as zt,aC as Js,aD as Ht,aE as Ut,aF as Vt,aG as _t,aH as Qs,aI as Yt,aJ as ea,aK as Wt,aL as qt,aM as ta,aN as sa,aO as aa,aP as mt,aQ as na,aR as ra,aS as ia,aT as oa,aU as la,aV as Kt,aW as da,aX as ca,aY as ee,aZ as ua}from"./vendor-VFQ9Nwoo.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=a(n);fetch(n.href,l)}})();const ma={apiKey:"AIzaSyBXo8aHR1FdhUeJDiH-eIseAue5SAgcTfI",authDomain:"newpeekwind.firebaseapp.com",projectId:"newpeekwind",storageBucket:"newpeekwind.appspot.com",messagingSenderId:"403242235671",appId:"1:403242235671:web:f204cbb8ab9c605dd12952",measurementId:"G-NLP2TN948M"};let ve,P,oe,ga,pa=null;try{ve=fs(ma),P=xs(ve),oe=js(ve),ga=vs(ve),bs().then(t=>{t&&(pa=Ns(ve))}).catch(console.error)}catch(t){console.error("Error initializing Firebase:",t),console.error("Firebase initialization error:",t)}const Qe=new xt,ha=new jt;Qe.addScope("https://www.googleapis.com/auth/userinfo.email");Qe.addScope("https://www.googleapis.com/auth/userinfo.profile");Qe.setCustomParameters({prompt:"select_account"});ha.setCustomParameters({prompt:"consent"});const Zt=d.createContext(void 0),fa=({children:t})=>{const[s,a]=d.useState(null),[r,n]=d.useState(!0),l=vt();d.useEffect(()=>{const p=ys(oe,N=>{a(N),n(!1)});return()=>p()},[]);const v={user:s,loading:r,signIn:async(p,N)=>{try{await at(oe,p,N),l("/dashboard")}catch(m){throw console.error("Error signing in:",m),m}},signUp:async(p,N)=>{try{await ws(oe,p,N),l("/dashboard")}catch(m){throw console.error("Error signing up:",m),m}},signInWithGithub:async()=>{try{const p=new jt;await nt(oe,p),l("/dashboard")}catch(p){throw console.error("Error signing in with GitHub:",p),p}},signInWithGoogle:async()=>{try{const p=new xt;await nt(oe,p),l("/dashboard")}catch(p){throw console.error("Error signing in with Google:",p),p}},createTestAccount:async()=>{try{await at(oe,"test@peekdiet.com","Asdf1234!"),l("/dashboard")}catch(p){throw console.error("Error signing in with test account:",p),p}},logout:async()=>{try{await Rs(oe),l("/login")}catch(p){throw console.error("Error signing out:",p),p}}};return e.jsx(Zt.Provider,{value:v,children:t})},ae=()=>{const t=d.useContext(Zt);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},ce=class ce{constructor(){re(this,"pendingOperations",[]);re(this,"isOnline",navigator.onLine);re(this,"syncStatus","synced");re(this,"syncInterval",null);re(this,"handleOnline",()=>{this.isOnline=!0,this.syncPendingOperations()});re(this,"handleOffline",()=>{this.isOnline=!1});window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),this.startSyncInterval()}static getInstance(){return ce.instance||(ce.instance=new ce),ce.instance}startSyncInterval(){this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval(()=>{this.isOnline&&this.pendingOperations.length>0&&this.syncPendingOperations()},5e3)}async queueOperation(s){const a={...s,timestamp:Date.now()};this.pendingOperations.push(a),this.syncStatus="pending",localStorage.setItem("pendingOperations",JSON.stringify(this.pendingOperations)),this.isOnline&&await this.syncPendingOperations()}async syncPendingOperations(){if(this.syncStatus==="syncing"||!this.isOnline)return;this.syncStatus="syncing";const s=Ss(P),a=[];try{for(let r=0;r<this.pendingOperations.length;r++){const n=this.pendingOperations[r],l=J(P,n.collection,n.docId);switch(n.type){case"create":s.set(l,n.data);break;case"update":s.update(l,n.data);break;case"delete":s.delete(l);break}}await s.commit(),a.push(...this.pendingOperations.map((r,n)=>n))}catch(r){console.error("Error syncing operations:",r)}finally{this.pendingOperations=this.pendingOperations.filter((r,n)=>!a.includes(n)),localStorage.setItem("pendingOperations",JSON.stringify(this.pendingOperations)),this.syncStatus=this.pendingOperations.length>0?"pending":"synced"}}getSyncStatus(){return{isOnline:this.isOnline,status:this.syncStatus,pendingOperations:this.pendingOperations.length}}async getDocument(s,a){const r=J(P,s,a);return As(r)}async setDocument(s,a,r){if(this.isOnline)try{const n=J(P,s,a);return await Es(n,r),!0}catch(n){return console.error("Error setting document:",n),!1}else return await this.queueOperation({type:"create",collection:s,docId:a,data:r}),!0}async updateDocument(s,a,r){if(this.isOnline)try{const n=J(P,s,a);return await be(n,r),!0}catch(n){return console.error("Error updating document:",n),!1}else return await this.queueOperation({type:"update",collection:s,docId:a,data:r}),!0}async deleteDocument(s,a){if(this.isOnline)try{const r=J(P,s,a);return await Xe(r),!0}catch(r){return console.error("Error deleting document:",r),!1}else return await this.queueOperation({type:"delete",collection:s,docId:a}),!0}};re(ce,"instance");let We=ce;const te=We.getInstance(),xa=()=>{const[t,s]=d.useState(te.getSyncStatus());return d.useEffect(()=>{const a=()=>{s(te.getSyncStatus())};window.addEventListener("online",a),window.addEventListener("offline",a);const r=setInterval(a,5e3);return()=>{window.removeEventListener("online",a),window.removeEventListener("offline",a),clearInterval(r)}},[]),{...t,setDocument:te.setDocument.bind(te),updateDocument:te.updateDocument.bind(te),deleteDocument:te.deleteDocument.bind(te),getDocument:te.getDocument.bind(te)}},ja=()=>{const{isOnline:t,status:s,pendingOperations:a}=xa(),r=()=>t?s==="synced"?"bg-green-500":s==="syncing"?"bg-blue-500":"bg-yellow-500":"bg-yellow-500",n=()=>t?s==="synced"?"Synced":s==="syncing"?"Syncing...":`Pending (${a})`:"Offline";return e.jsxs("div",{className:"fixed bottom-4 right-4 flex items-center space-x-2 bg-white p-2 rounded-lg shadow",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${r()}`}),e.jsx("span",{className:"text-sm text-gray-700",children:n()})]})},ie=({children:t})=>{const{user:s,loading:a}=ae(),r=Je();return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-peekdiet-secondary"}),e.jsx("div",{className:"mt-4 h-4 w-32 bg-muted rounded"})]})}):s?e.jsx(e.Fragment,{children:t}):e.jsx(Ts,{to:"/login",state:{from:r},replace:!0})};function S(...t){return ks(Is(t))}const B=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:S("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s}));B.displayName="Card";const z=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:S("flex flex-col space-y-1.5 p-6",t),...s}));z.displayName="CardHeader";const H=d.forwardRef(({className:t,...s},a)=>e.jsx("h3",{ref:a,className:S("text-2xl font-semibold leading-none tracking-tight",t),...s}));H.displayName="CardTitle";const K=d.forwardRef(({className:t,...s},a)=>e.jsx("p",{ref:a,className:S("text-sm text-muted-foreground",t),...s}));K.displayName="CardDescription";const U=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:S("p-6 pt-0",t),...s}));U.displayName="CardContent";const Se=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:S("flex items-center p-6 pt-0",t),...s}));Se.displayName="CardFooter";const va=Ms,Xt=d.forwardRef(({className:t,...s},a)=>e.jsx(bt,{ref:a,className:S("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));Xt.displayName=bt.displayName;const qe=d.forwardRef(({className:t,...s},a)=>e.jsx(Nt,{ref:a,className:S("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s}));qe.displayName=Nt.displayName;const Ke=d.forwardRef(({className:t,...s},a)=>e.jsx(yt,{ref:a,className:S("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));Ke.displayName=yt.displayName;const ba=Ie("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),M=d.forwardRef(({className:t,variant:s,size:a,asChild:r=!1,...n},l)=>{const i=r?Os:"button";return e.jsx(i,{className:S(ba({variant:s,size:a,className:t})),ref:l,...n})});M.displayName="Button";const Na=Ie("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),$e=d.forwardRef(({className:t,variant:s,...a},r)=>e.jsx("div",{ref:r,role:"alert",className:S(Na({variant:s}),t),...a}));$e.displayName="Alert";const ya=d.forwardRef(({className:t,...s},a)=>e.jsx("h5",{ref:a,className:S("mb-1 font-medium leading-none tracking-tight",t),...s}));ya.displayName="AlertTitle";const Fe=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:S("text-sm [&_p]:leading-relaxed",t),...s}));Fe.displayName="AlertDescription";const wa=()=>{const{signInWithGithub:t,loading:s}=ae(),[a,r]=d.useState(null),n=async()=>{try{r(null),await t()}catch(l){console.error("Failed to sign in with GitHub:",l),l instanceof Error?l.message.includes("auth/unauthorized-domain")?r("This domain is not authorized for GitHub sign-in. Please add it to your Firebase authentication settings."):l.message.includes("auth/popup-closed-by-user")?r("Sign-in popup was closed. Please try again."):l.message.includes("auth/popup-blocked")?r("Sign-in popup was blocked by your browser. Please allow popups for this site."):r(`Authentication error: ${l.message}`):r("An unknown error occurred. Please try again later.")}};return e.jsxs("div",{className:"space-y-2 w-full",children:[a&&e.jsx($e,{variant:"destructive",className:"mb-2",children:e.jsxs(Fe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:a}),e.jsx(Re,{className:"h-4 w-4 cursor-pointer",onClick:()=>r(null)})]})}),e.jsxs(M,{variant:"outline",onClick:n,disabled:s,className:"w-full flex items-center gap-2",children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})}),"Sign in with GitHub"]})]})},Ra=()=>{const{signInWithGoogle:t,loading:s}=ae(),[a,r]=d.useState(null),n=async()=>{try{r(null),await t()}catch(l){console.error("Failed to sign in with Google:",l),l instanceof Error?l.message.includes("auth/unauthorized-domain")?r("This domain is not authorized for Google sign-in. Please add it to your Firebase authentication settings."):l.message.includes("auth/popup-closed-by-user")?r("Sign-in popup was closed. Please try again."):l.message.includes("auth/popup-blocked")?r("Sign-in popup was blocked by your browser. Please allow popups for this site."):r(`Authentication error: ${l.message}`):r("An unknown error occurred. Please try again later.")}};return e.jsxs("div",{className:"space-y-2 w-full",children:[a&&e.jsx($e,{variant:"destructive",className:"mb-2",children:e.jsxs(Fe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:a}),e.jsx(Re,{className:"h-4 w-4 cursor-pointer",onClick:()=>r(null)})]})}),e.jsxs(M,{variant:"outline",onClick:n,disabled:s,className:"w-full flex items-center gap-2",children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",children:e.jsxs("g",{transform:"matrix(1, 0, 0, 1, 27.009001, -39.238998)",children:[e.jsx("path",{fill:"#4285F4",d:"M -3.264 51.509 C -3.264 50.719 -3.334 49.969 -3.454 49.239 L -14.754 49.239 L -14.754 53.749 L -8.284 53.749 C -8.574 55.229 -9.424 56.479 -10.684 57.329 L -10.684 60.329 L -6.824 60.329 C -4.564 58.239 -3.264 55.159 -3.264 51.509 Z"}),e.jsx("path",{fill:"#34A853",d:"M -14.754 63.239 C -11.514 63.239 -8.804 62.159 -6.824 60.329 L -10.684 57.329 C -11.764 58.049 -13.134 58.489 -14.754 58.489 C -17.884 58.489 -20.534 56.379 -21.484 53.529 L -25.464 53.529 L -25.464 56.619 C -23.494 60.539 -19.444 63.239 -14.754 63.239 Z"}),e.jsx("path",{fill:"#FBBC05",d:"M -21.484 53.529 C -21.734 52.809 -21.864 52.039 -21.864 51.239 C -21.864 50.439 -21.724 49.669 -21.484 48.949 L -21.484 45.859 L -25.464 45.859 C -26.284 47.479 -26.754 49.299 -26.754 51.239 C -26.754 53.179 -26.284 54.999 -25.464 56.619 L -21.484 53.529 Z"}),e.jsx("path",{fill:"#EA4335",d:"M -14.754 43.989 C -12.984 43.989 -11.404 44.599 -10.154 45.789 L -6.734 42.369 C -8.804 40.429 -11.514 39.239 -14.754 39.239 C -19.444 39.239 -23.494 41.939 -25.464 45.859 L -21.484 48.949 C -20.534 46.099 -17.884 43.989 -14.754 43.989 Z"})]})}),"Sign in with Google"]})]})},we=d.forwardRef(({className:t,type:s,...a},r)=>e.jsx("input",{type:s,className:S("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...a}));we.displayName="Input";const Sa=Ie("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ue=d.forwardRef(({className:t,...s},a)=>e.jsx(wt,{ref:a,className:S(Sa(),t),...s}));ue.displayName=wt.displayName;const Aa=()=>{const{signIn:t,signUp:s,loading:a}=ae(),[r,n]=d.useState(""),[l,i]=d.useState(""),[o,u]=d.useState(!1),[x,c]=d.useState(null),g=async v=>{v.preventDefault();try{c(null),o?await s(r,l):await t(r,l)}catch(p){console.error("Authentication error:",p),p instanceof Error?p.message.includes("auth/invalid-email")?c("Please enter a valid email address."):p.message.includes("auth/user-not-found")?c("No account found with this email address."):p.message.includes("auth/wrong-password")?c("Incorrect password. Please try again."):p.message.includes("auth/email-already-in-use")?c("This email is already registered. Please sign in instead."):p.message.includes("auth/weak-password")?c("Password should be at least 6 characters long."):c(`Authentication error: ${p.message}`):c("An unknown error occurred. Please try again later.")}};return e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[x&&e.jsx($e,{variant:"destructive",children:e.jsxs(Fe,{className:"flex justify-between items-center",children:[e.jsx("span",{children:x}),e.jsx(Re,{className:"h-4 w-4 cursor-pointer",onClick:()=>c(null)})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{htmlFor:"email",children:"Email"}),e.jsx(we,{id:"email",type:"email",placeholder:"Enter your email",value:r,onChange:v=>n(v.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{htmlFor:"password",children:"Password"}),e.jsx(we,{id:"password",type:"password",placeholder:"Enter your password",value:l,onChange:v=>i(v.target.value),required:!0})]}),e.jsx(M,{type:"submit",className:"w-full",disabled:a,children:o?"Sign Up":"Sign In"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>u(!o),className:"text-sm text-muted-foreground hover:text-primary",children:o?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})},Ea="1.6.0",Ta=()=>{const[t,s]=d.useState("social"),{createTestAccount:a,loading:r}=ae();return vt(),e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-b from-peekdiet-light to-background",children:e.jsxs(B,{className:"w-full max-w-md",children:[e.jsxs(z,{className:"space-y-1",children:[e.jsxs(H,{className:"text-2xl text-center",children:[e.jsx("span",{className:"text-peekdiet-primary",children:"Peek"}),e.jsx("span",{className:"text-peekdiet-accent",children:"Diet"})]}),e.jsx(K,{className:"text-center",children:"Track your glucose response to meals with precision"})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Sign in to your account"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor your blood glucose levels and take control of your health"})]}),e.jsxs(va,{defaultValue:"social",onValueChange:s,children:[e.jsxs(Xt,{className:"grid grid-cols-2 w-full",children:[e.jsx(qe,{value:"social",children:"Social"}),e.jsx(qe,{value:"email",children:"Email"})]}),e.jsxs(Ke,{value:"social",className:"space-y-4 pt-4",children:[e.jsx(Ra,{}),e.jsx(wa,{})]}),e.jsx(Ke,{value:"email",className:"pt-4",children:e.jsx(Aa,{})})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(M,{variant:"outline",className:"w-full text-sm",onClick:a,disabled:r,children:"Use Test Account (test@peekdiet.com / Asdf1234!)"})})]}),e.jsx(Se,{className:"flex flex-col space-y-2",children:e.jsxs("div",{className:"text-sm text-center text-muted-foreground",children:[e.jsx("p",{children:"By signing in, you agree to our terms of service and privacy policy."}),e.jsxs("p",{className:"mt-1 text-xs",children:["Version ",Ea]})]})})]})})},ka=1,Ia=1e6;let Be=0;function Ma(){return Be=(Be+1)%Number.MAX_SAFE_INTEGER,Be.toString()}const ze=new Map,gt=t=>{if(ze.has(t))return;const s=setTimeout(()=>{ze.delete(t),ye({type:"REMOVE_TOAST",toastId:t})},Ia);ze.set(t,s)},Oa=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,ka)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(a=>a.id===s.toast.id?{...a,...s.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=s;return a?gt(a):t.toasts.forEach(r=>{gt(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==s.toastId)}}},Ee=[];let Te={toasts:[]};function ye(t){Te=Oa(Te,t),Ee.forEach(s=>{s(Te)})}function me({...t}){const s=Ma(),a=n=>ye({type:"UPDATE_TOAST",toast:{...n,id:s}}),r=()=>ye({type:"DISMISS_TOAST",toastId:s});return ye({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:n=>{n||r()}}}),{id:s,dismiss:r,update:a}}function et(){const[t,s]=d.useState(Te);return d.useEffect(()=>(Ee.push(s),()=>{const a=Ee.indexOf(s);a>-1&&Ee.splice(a,1)}),[t]),{...t,toast:me,dismiss:a=>ye({type:"DISMISS_TOAST",toastId:a})}}const je={timeout:{original:7,testing:2},cycleTimeout:{original:190,testing:21},intervals:{original:{firstBite:0,readings:[20,40,60,90,120,180]},testing:{firstBite:0,readings:[3,6,9,12,15,18]}}},ge=(t="original")=>t==="testing"?je.intervals.testing:je.intervals.original,Jt=(t="original")=>t==="testing"?je.timeout.testing:je.timeout.original,fe=(t="original")=>t==="testing"?je.cycleTimeout.testing:je.cycleTimeout.original,Da=()=>{const t=Date.now(),s=Math.random().toString(36).substring(2,8);return`mc-${t}-${s}`},he=(t="original")=>{const{user:s}=ae(),[a,r]=d.useState([]),[n,l]=d.useState(null),[i,o]=d.useState(null),[u,x]=d.useState(!0),[c,g]=d.useState(!1),[v,p]=d.useState(null),[N,m]=d.useState([]),{toast:j}=et(),C=d.useRef(!1),[D,A]=d.useState(!1);d.useRef(0),d.useEffect(()=>{if(C.current)return;const h=async()=>{g(!1);try{await Ds(P),j({title:"You're back online",description:"Your data will now sync with the server."}),k()}catch(y){console.error("Error enabling network:",y),j({title:"Connection Error",description:"Failed to reconnect to the server. Please try again.",variant:"destructive"})}},f=async()=>{g(!0);try{await Ls(P),j({title:"You're offline",description:"The app will continue to work, but changes won't be saved to the server until you're back online.",variant:"destructive"})}catch(y){console.error("Error disabling network:",y)}};return window.addEventListener("online",h),window.addEventListener("offline",f),g(!navigator.onLine),C.current=!0,()=>{window.removeEventListener("online",h),window.removeEventListener("offline",f)}},[j]);const k=async()=>{if(N.length===0)return;const h=[...N];m([]);for(const f of h)try{switch(f.type){case"start":await G(f.data.preprandialValue);break;case"firstBite":await Z();break;case"reading":await X(f.data.minutesMark,f.data.value);break;case"abandon":await b();break}}catch(y){console.error(`Failed to retry ${f.type} action:`,y),m(T=>[...T,f])}};d.useEffect(()=>{if(!s){r([]),l(null),o(null),x(!1);return}(async()=>{try{x(!0),p(null);const f=Ve(Ne(P,"mealCycles"),_e("userId","==",s.uid)),y=await rt(f),T=[];y.forEach(E=>{const w=E.data(),F=w.createdAt instanceof Y?w.createdAt.toMillis():w.createdAt,W=w.updatedAt instanceof Y?w.updatedAt.toMillis():w.updatedAt,V=w.startTime instanceof Y?w.startTime.toMillis():w.startTime,R=w.preprandialReading?{...w.preprandialReading,timestamp:w.preprandialReading.timestamp instanceof Y?w.preprandialReading.timestamp.toMillis():w.preprandialReading.timestamp,createdAt:w.preprandialReading.createdAt instanceof Y?w.preprandialReading.createdAt.toMillis():w.preprandialReading.createdAt,updatedAt:w.preprandialReading.updatedAt instanceof Y?w.preprandialReading.updatedAt.toMillis():w.preprandialReading.updatedAt}:void 0,L=w.postprandialReadings?Object.entries(w.postprandialReadings).reduce((le,[de,Ae])=>(le[de]={...Ae,timestamp:Ae.timestamp instanceof Y?Ae.timestamp.toMillis():Ae.timestamp},le),{}):{},Q={id:E.id,...w,status:w.archived?"abandoned":w.status,createdAt:F,updatedAt:W,startTime:V,preprandialReading:R,postprandialReadings:L};T.push(Q)}),T.sort((E,w)=>w.createdAt-E.createdAt),r(T);const O=T.find(E=>E.status==="active"&&!E.archived);(!n||!T.find(E=>E.id===n.id)||n.status!=="active"||n.archived)&&l(O||null),o(null)}catch(f){console.error("Error fetching meal cycles:",f),c||!navigator.onLine?p("You're currently offline. Your data will sync when you're back online."):p("Could not connect to the database. Please try again later.")}finally{x(!1)}})()},[s,c,j]);const G=async h=>{if(!s)return null;p(null),A(!0);try{const f=Y.now(),y=f.toMillis(),T=Da(),O={userId:s.uid,value:h,timestamp:f,type:"preprandial",createdAt:f,updatedAt:f},E={userId:s.uid,startTime:0,preprandialReading:{id:"temp_"+y,...O},postprandialReadings:{},status:"active",createdAt:f,updatedAt:f,uniqueId:T};return o(E),c||!navigator.onLine?(j({title:"Preprandial reading saved",description:"You're offline, but you can continue with your meal cycle. Your data will sync when you're back online."}),m(F=>[...F,{type:"start",data:{preprandialValue:h},timestamp:y}]),A(!1),E):((async()=>{try{const F=await Rt(Ne(P,"mealCycles"),E),W={id:F.id,...E,preprandialReading:{id:F.id+"_pre",...O}};r(V=>[W,...V]),l(W),o(null),j({title:"Meal cycle started",description:`Your preprandial reading has been recorded (ID: ${T.substring(0,8)}). Press 'First Bite' when you start eating.`})}catch(F){console.error("Error saving to Firestore:",F),m(W=>[...W,{type:"start",data:{preprandialValue:h},timestamp:y}]),j({title:"Offline Mode",description:"Your data will sync when you're back online.",variant:"destructive"})}})().catch(console.error),A(!1),E)}catch(f){return console.error("Error starting meal cycle:",f),j({title:"Error starting meal cycle",description:f instanceof Error?f.message:"Unknown error",variant:"destructive"}),p("Failed to start meal cycle. Please try again."),A(!1),null}},Z=async()=>{if(!s)return null;p(null);try{const h=Y.now(),f=h.toMillis();if(i){const T={...i,startTime:f,updatedAt:f};if(o(null),l(T),r(O=>[T,...O]),j({title:"First bite recorded",description:"Your meal cycle timer has started. You'll receive notifications for glucose readings."}),c||!navigator.onLine)return m(O=>[...O,{type:"firstBite",data:{},timestamp:f}]),T;try{const O=J(P,"mealCycles",T.id);await be(O,{startTime:h,updatedAt:h})}catch(O){console.error("Error saving first bite to Firestore:",O),m(E=>[...E,{type:"firstBite",data:{},timestamp:f}])}return T}if(!n)return j({title:"No active meal cycle",description:"Please start a meal cycle first.",variant:"destructive"}),null;const y={...n,startTime:f,updatedAt:f};if(l(y),r(T=>T.map(O=>O.id===y.id?y:O)),j({title:"First bite recorded",description:"Your meal cycle timer has started. You'll receive notifications for glucose readings."}),c||!navigator.onLine)return m(T=>[...T,{type:"firstBite",data:{},timestamp:f}]),y;try{await be(J(P,"mealCycles",n.id),{startTime:h,updatedAt:h})}catch(T){console.error("Error saving first bite to Firestore:",T),m(O=>[...O,{type:"firstBite",data:{},timestamp:f}])}return y}catch(h){return console.error("Error recording first bite:",h),j({title:"Error recording first bite",description:h instanceof Error?h.message:"Unknown error",variant:"destructive"}),null}},X=async(h,f)=>{if(!n||!s)return null;try{const y=Y.now(),T=y.toMillis(),O=n.startTime+h*60*1e3,E=Jt(t);if(T>O+E*60*1e3)return j({title:"Reading too late",description:`You're more than ${E} minutes late for the ${h}-minute reading. This reading will not be counted.`,variant:"destructive"}),null;const F={userId:s.uid,value:f,timestamp:y,type:"postprandial",minutesMark:h,createdAt:y,updatedAt:y};console.log(`📊 Glucose Reading Submitted:
  - Time Mark: ${h} minutes
  - Value: ${f} mg/dL
  - Readings Count: ${Object.keys(n.postprandialReadings).length+1}/6`);const W={...n.postprandialReadings,[h]:F},V=h===180,R=V?"completed":"active";await be(J(P,"mealCycles",n.id),{[`postprandialReadings.${h}`]:F,status:R,updatedAt:y});const L={...n,postprandialReadings:W,status:R,updatedAt:T};return r(Q=>Q.map(le=>le.id===L.id?L:le)),V?(l(null),j({title:"Meal cycle completed",description:"Your 3-hour meal cycle is now complete. You can view the results in your history."})):(l(L),j({title:"Reading recorded",description:`Your ${h}-minute reading has been saved successfully.`})),L}catch(y){return j({title:"Error recording reading",description:y instanceof Error?y.message:"Unknown error",variant:"destructive"}),null}},b=async h=>{if(!n||!s)return!1;try{if(console.log("Updating meal cycle status:",n.id),["completed","canceled"].includes(n.status))return j({title:"Cannot change meal cycle status",description:`This meal cycle is already ${n.status}.`,variant:"destructive"}),!1;const f=ge(t).readings[5],y=n.postprandialReadings&&n.postprandialReadings[f]!==void 0;y&&(h={status:"completed"});const O=ge(t).readings.every(w=>n.postprandialReadings&&n.postprandialReadings[w]!==void 0);y&&(h={status:"completed"});const E=(h==null?void 0:h.status)||(h!=null&&h.userInitiated?"canceled":"abandoned");if(c||!navigator.onLine){if(console.log("Updating meal cycle status offline"),n.id.startsWith("temp_")||!n.id)r(w=>w.filter(F=>F.id!==n.id));else{const F=Y.now().toMillis();r(W=>W.map(V=>V.id===n.id?{...V,status:E,updatedAt:F}:V))}return l(null),j({title:`Meal Cycle ${E.charAt(0).toUpperCase()+E.slice(1)}`,description:`Your current meal cycle has been ${E}.`}),!0}try{console.log(`Marking meal cycle status: ${n.id}`);const w=Y.now(),F=w.toMillis();return await be(J(P,"mealCycles",n.id),{status:E,updatedAt:w}),r(W=>W.map(V=>V.id===n.id?{...V,status:E,updatedAt:F}:V)),l(null),j({title:`Meal Cycle ${E.charAt(0).toUpperCase()+E.slice(1)}`,description:`Your current meal cycle has been ${E}.`}),!0}catch(w){return console.error("Error marking meal cycle status:",w),!1}}catch(f){return console.error("Error in abandonMealCycle:",f),!1}};return{mealCycles:a,activeMealCycle:n,pendingMealCycle:i,loading:u,isOffline:c,error:v,isStartingMealCycle:D,startMealCycle:G,recordFirstBite:Z,recordPostprandialReading:X,abandonMealCycle:b,deleteMealCycle:async h=>{if(!s)return j({title:"Error",description:"You must be logged in to delete meal cycles.",variant:"destructive"}),!1;try{return await Xe(J(P,"mealCycles",h)),r(f=>f.filter(y=>y.id!==h)),j({title:"Success",description:"Meal cycle deleted successfully.",variant:"default"}),!0}catch(f){return console.error("Error deleting meal cycle:",f),j({title:"Error",description:"Failed to delete meal cycle.",variant:"destructive"}),!1}},clearAllSessions:async()=>{if(!s)return j({title:"Error",description:"You must be logged in to clear sessions.",variant:"destructive"}),!1;try{const h=h(P),f=Ne(P,"mealCycles"),y=Ve(f,_e("userId","==",s.uid));return(await rt(y)).docs.forEach(O=>h.delete(O.ref)),await h.commit(),r([]),l(null),j({title:"Success",description:"All meal cycles have been deleted.",variant:"default"}),!0}catch(h){return console.error("Error clearing all sessions:",h),j({title:"Error",description:"Failed to clear all sessions.",variant:"destructive"}),!1}}}};let _=null,q=null;const pt=()=>{q&&(q.stop(),q=null),_&&(_.close(),_=null);try{_=new(window.AudioContext||window.webkitAudioContext),q=_.createOscillator();const t=_.createGain();q.type="sine",q.frequency.setValueAtTime(800,_.currentTime),t.gain.setValueAtTime(.5,_.currentTime),q.connect(t),t.connect(_.destination),q.start(),q.stop(_.currentTime+.5),q.onended=()=>{_&&(_.close(),_=null),q=null}}catch(t){console.error("Error playing notification sound:",t),q&&(q.stop(),q=null),_&&(_.close(),_=null)}},Qt=()=>"Notification"in window,La=()=>/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Pa=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Ca=async()=>{if(!Qt())return console.log("Notifications not supported in this browser"),!1;if(La()&&Pa())return me({title:"Enable Notifications",description:"To receive alerts, please enable notifications in your Safari settings. Go to Settings > Safari > Notifications and allow notifications for this website.",duration:1e4,variant:"default"}),!1;try{return await Notification.requestPermission()==="granted"}catch(t){return console.error("Error requesting notification permission:",t),!1}},Ga=(t,s)=>{if(!Qt())return;const a={...s,icon:"/favicon.ico",badge:"/badge.png",vibrate:s.type==="readingDue"?[200,100,200]:s.type==="readingOverdue"?[200,100,200,100,200]:[200,100,200,100,200,100,200]},{type:r,...n}=a;Notification.permission==="granted"&&new Notification(t,n)},es=(t,s)=>{const{toast:a}=et(),[r,n]=d.useState(!1),[l,i]=d.useState(""),[o,u]=d.useState(""),[x,c]=d.useState(!1),[g,v]=d.useState({});d.useEffect(()=>{(async()=>{const j=await Ca();c(j)})()},[]);const p=d.useCallback((m,j,C=!1,D="readingDue")=>{C?(pt(),x&&Ga(m,{body:j,tag:"glucose-reading",renotify:!0,type:D}),u(m),i(j),n(!0)):a({title:m,description:j,duration:5e3})},[a,x]),N=d.useCallback(m=>{if(!(t!=null&&t.startTime))return{due:!1,overdue:!1,timeUntil:null};const j=Date.now(),D=t.startTime+m*60*1e3-j,A=Jt()*60*1e3,k=D<=0&&D>-A,G=D<=-A;return t.postprandialReadings[m]?{due:!1,overdue:!1,timeUntil:null}:{due:k,overdue:G,timeUntil:D>0?D:null}},[t==null?void 0:t.startTime,t==null?void 0:t.postprandialReadings]);return d.useEffect(()=>{if(!(t!=null&&t.startTime))return;const j=setInterval(()=>{const C=ge(s).readings;for(const D of C){if(t.postprandialReadings[D])continue;N(D).due&&!g[D]&&(pt(),v(k=>({...k,[D]:!0})))}},1e3);return()=>clearInterval(j)},[t,N,g,s]),{showNotification:p,getNotificationStatus:N,alertState:{isOpen:r,onClose:()=>n(!1),title:o,description:l}}},He={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyB8iporZmL1ioVMIrzfFEngzbBBGYjb4HU",VITE_FIREBASE_APP_ID:"1:87617577060:web:b06765cbffa87433e5ff71",VITE_FIREBASE_AUTH_DOMAIN:"newpeek-c5196.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-0CMN16ZBX8",VITE_FIREBASE_MESSAGING_SENDER_ID:"87617577060",VITE_FIREBASE_PROJECT_ID:"newpeek-c5196",VITE_FIREBASE_STORAGE_BUCKET:"newpeek-c5196.firebasestorage.app"},$a=(He==null?void 0:He.VITE_APP_VERSION)||"dev",Fa=()=>{const[t,s]=ne.useState(!navigator.onLine),{activeMealCycle:a}=he(),[r,n]=ne.useState(null);ne.useEffect(()=>{const i=()=>s(!1),o=()=>s(!0);return window.addEventListener("online",i),window.addEventListener("offline",o),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",o)}},[]),ne.useEffect(()=>{if(!(a!=null&&a.startTime)){n(null);return}const i=fe()*60*1e3,o=a.startTime+i,u=()=>{const c=Date.now(),g=o-c;n(g>0?g:0)};u();const x=setInterval(u,1e3);return()=>clearInterval(x)},[a==null?void 0:a.startTime]);const l=i=>{const o=Math.ceil(i/1e3),u=Math.floor(o/3600),x=Math.floor(o%3600/60),c=o%60;return u>0?`${u}h ${x}m ${c}s`:`${x}m ${c}s`};return e.jsx("footer",{className:"border-t py-4 mt-auto",children:e.jsxs("div",{className:"container flex justify-between items-center text-xs text-muted-foreground",children:[e.jsx("div",{children:e.jsx("span",{children:" 2025 PeekDiet"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[r!==null&&e.jsxs("div",{className:"flex items-center text-amber-500",children:[e.jsx(St,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:["Cycle ends in ",l(r)]})]}),t&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(At,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"Offline"})]}),e.jsxs("span",{children:["v",$a]})]})]})})},Ba=({onStartAdhoc:t,onStartMeal:s})=>e.jsxs(B,{className:"w-full",children:[e.jsxs(z,{children:[e.jsx(H,{className:"text-center",children:"Track Your Glucose"}),e.jsx(K,{className:"text-center",children:"Monitor your blood glucose response to meals"})]}),e.jsx(U,{className:"flex flex-col items-center",children:e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"h-32 w-32 rounded-full bg-peekdiet-secondary flex items-center justify-center",children:e.jsx(Ps,{className:"h-16 w-16 text-peekdiet-primary"})})})}),e.jsxs(Se,{className:"flex flex-col space-y-2",children:[e.jsx(M,{onClick:s,className:"w-full",children:"Start Meal Cycle"}),e.jsx(M,{variant:"outline",onClick:t,className:"w-full",children:"Ad-hoc Reading"})]})]}),ts=d.forwardRef(({className:t,trackColor:s="bg-primary",...a},r)=>e.jsxs(Et,{ref:r,className:S("relative flex w-full touch-none select-none items-center",t),...a,children:[e.jsx(Cs,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Gs,{className:`absolute h-full ${s}`})}),e.jsx($s,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));ts.displayName=Et.displayName;const Ue=({timePoint:t,onSubmit:s,onAbandonCycle:a,onCompleteCycle:r,activeMealCycle:n=null,mode:l="testing"})=>{const[i,o]=d.useState(120),{toast:u}=et();he();const x=N=>{o(N[0])},c=()=>{o(Math.min(300,i+1))},g=()=>{o(Math.max(50,i-1))},v=()=>{const N=n?n.startTime+t*60*1e3:0,m=Date.now(),j=m<N-fe(l)*60*1e3,C=m>N+fe(l)*60*1e3;if(console.error("🩺 SAVE READING DEBUG",{value:i,timePoint:t,activeMealCycle:!!n,postprandialReadings:n==null?void 0:n.postprandialReadings,expectedIntervals:ge(l).readings,cycleStatus:n==null?void 0:n.status,onSubmitType:typeof s,onAbandonCycleType:typeof a,isEarly:j,isLate:C,expectedTime:N,nowMillis:m}),i<50||i>300){u({title:"Invalid Value",description:"Please enter a glucose value between 50 and 300 mg/dL",variant:"destructive"});return}if(!s){console.error("❌ CRITICAL: onSubmit is not defined!",{onSubmitFunction:s,componentProps:{value:i,timePoint:t,mode:l}}),u({title:"Submission Error",description:"Unable to save reading. Please contact support.",variant:"destructive"});return}if(n){const A=ge(l).readings,k=A[A.length-1],Z=(Date.now()-n.startTime)/(60*1e3),X=fe(l),b={currentTimePoint:t,lastInterval:k,intervals:A,postprandialReadings:n.postprandialReadings||{},isLastIntervalReading:t===k,hasAllReadings:A.every(h=>n.postprandialReadings&&n.postprandialReadings[h]!==void 0),minutesElapsed:Z,cycleTimeout:X};console.error("🚨 COMPLETION VERIFICATION:",JSON.stringify(b,null,2)),console.error("🔍 READING DETAILS:",A.map(h=>{var f,y;return{interval:h,hasReading:!!((f=n.postprandialReadings)!=null&&f[h]),reading:(y=n.postprandialReadings)==null?void 0:y[h]}}));const I=t===k,$=A.every(h=>n.postprandialReadings&&n.postprandialReadings[h]!==void 0);if(I||$){console.warn("🏁 Meal Cycle Completion Triggered:",{reason:I?"Last interval reading":"All readings completed"}),u({title:"Meal Cycle Completed",description:"Your glucose tracking for this meal is now complete.",variant:"default"}),r==null||r();return}}(()=>{console.error("📝 READING SUBMISSION ATTEMPT",{timePoint:t,value:i,expectedIntervals:ge(l).readings,onSubmitFunction:!!s});const A=s(i);console.error("📝 READING SUBMISSION RESULT",{timePoint:t,value:i,submissionResult:A})})(),u({title:"Reading Recorded",description:`${i} mg/dL at ${t} minutes recorded successfully`})},p=()=>i<65?"text-blue-600":i<=90?"text-green-600":i<=105?"text-yellow-600":i<=140?"text-orange-600":i<=180?"text-red-600":"text-purple-600";return e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-center text-[3rem] font-bold mb-6 text-gray-800",children:"Glucose Reading"}),e.jsx("div",{className:"text-center mb-4",children:e.jsx("div",{className:"text-[2rem] text-center text-gray-600",children:i<65?e.jsx("span",{className:"text-blue-600",children:"Extreme Weight Loss"}):i<=90?e.jsx("span",{className:"text-green-600",children:"Weight Loss Range"}):i<=110?e.jsx("span",{className:"text-yellow-600",children:"Maintain Weight"}):i<=140?e.jsx("span",{className:"text-orange-600",children:"Weight Gain Range"}):i<=180?e.jsx("span",{className:"text-red-600",children:"Extreme Weight Gain"}):e.jsx("span",{className:"text-purple-600",children:"Extreme Weight Gain"})})}),e.jsx("div",{className:"text-center mb-4",children:e.jsxs("span",{className:`text-4xl font-bold ${p()}`,children:[i," mg/dL"]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(M,{variant:"outline",size:"icon",onClick:g,className:"h-10 w-10 rounded-full",children:e.jsx("span",{className:"text-[2.5rem]",children:"-"})}),e.jsx("div",{className:"flex-1",children:e.jsx(ts,{value:[i],min:50,max:300,step:1,onValueChange:x,className:"flex-1",trackColor:i<65?"bg-blue-500":i<=90?"bg-green-500":i<=110?"bg-yellow-500":i<=140?"bg-orange-500":i<=180?"bg-red-500":"bg-purple-500"})}),e.jsx(M,{variant:"outline",size:"icon",onClick:c,className:"h-10 w-10 rounded-full",children:e.jsx("span",{className:"text-[2.5rem]",children:"+"})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(M,{onClick:v,size:"lg",className:"mx-auto",children:"Save Reading"})})]})},za=({onFirstBite:t,preprandialValue:s,uniqueId:a})=>{const r=()=>{console.log("First bite button clicked"),t()};return e.jsxs(B,{className:"w-full",children:[e.jsxs(z,{children:[e.jsx(H,{className:"text-center",children:"Ready to Eat?"}),e.jsx(K,{className:"text-center",children:s?e.jsxs("span",{children:["We've recorded your preprandial reading of"," ",e.jsxs("span",{className:"font-semibold",children:[s," mg/dL"]}),a&&e.jsxs("div",{className:"mt-1 text-xs",children:["Meal Cycle ID: ",a.substring(0,8)]})]}):e.jsx("span",{children:"Let us know when you take your first bite"})})]}),e.jsx(U,{className:"flex justify-center",children:e.jsx("div",{className:"h-32 w-32 rounded-full bg-peekdiet-secondary flex items-center justify-center",children:e.jsx(Fs,{className:"h-16 w-16 text-peekdiet-primary"})})}),e.jsx(Se,{children:e.jsx(M,{onClick:r,className:"w-full text-lg py-6",size:"lg",children:"First Bite"})})]})},ss=d.forwardRef(({className:t,value:s,...a},r)=>e.jsx(Tt,{ref:r,className:S("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...a,children:e.jsx(Bs,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));ss.displayName=Tt.displayName;const as=({mealCycle:t})=>{console.log("[GlucoseGraph] Rendering with meal cycle:",{id:t.id,preprandial:t.preprandialReading,postprandial:t.postprandialReadings});const a=(()=>{const o=[];t.preprandialReading&&(console.log("[GlucoseGraph] Adding preprandial reading:",t.preprandialReading),o.push({name:"Pre",glucose:t.preprandialReading.value,time:0}));const u=Object.entries(t.postprandialReadings).sort(([x],[c])=>Number(x)-Number(c));return console.log("[GlucoseGraph] Sorted postprandial readings:",u),u.forEach(([x,c])=>{c&&c.value!==null&&c.value!==void 0&&(console.log(`[GlucoseGraph] Adding ${x}m reading:`,c),o.push({name:`${x}m`,glucose:c.value,time:Number(x)}))}),console.log("[GlucoseGraph] Final data array:",o),o})();if(a.length===0)return console.log("[GlucoseGraph] No data to display"),null;const r=Math.min(...a.map(o=>o.glucose)),n=Math.max(...a.map(o=>o.glucose)),l=10,i=[Math.max(0,r-l),n+l];return e.jsx(Me,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:a,margin:{top:5,right:5,left:5,bottom:5},children:[e.jsx(De,{strokeDasharray:"3 3",opacity:.2}),e.jsx(Le,{dataKey:"name",tick:{fontSize:10}}),e.jsx(Pe,{domain:i,tick:{fontSize:10}}),e.jsx(Ce,{formatter:o=>[`${o} mg/dL`,"Glucose"],labelFormatter:o=>o}),e.jsx(Ge,{type:"monotone",dataKey:"glucose",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6},connectNulls:!0})]})})},xe=t=>{const s=[t.preprandialReading,...Object.values(t.postprandialReadings)].filter(n=>n&&n.value!==null&&n.value!==void 0&&n.value>0);if(console.log("[calculateAverageGlucose] Valid readings:",s),console.log("[calculateAverageGlucose] Reading values:",s.map(n=>n.value)),s.length===0)return null;const a=s.reduce((n,l)=>n+l.value,0),r=Math.round(a/s.length);return console.log("[calculateAverageGlucose] Sum:",a),console.log("[calculateAverageGlucose] Count:",s.length),console.log("[calculateAverageGlucose] Average:",r),r},tt=t=>{const s=[t.preprandialReading,...Object.values(t.postprandialReadings)].filter(a=>a&&a.value!==null&&a.value!==void 0&&a.value>0);return s.length===0?null:Math.max(...s.map(a=>a.value))},pe=t=>{if(!t||t===0)return"Not started";try{const s=typeof t=="number"?new Date(t):t instanceof Y?t.toDate():new Date(t);return isNaN(s.getTime())?(console.error("Invalid date:",t),"Not started"):s.toLocaleString("en-US",{timeZone:"America/New_York",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(s){return console.error("Error converting timestamp:",s),"Not started"}},Ha=({mealCycle:t,onTakeReading:s,onAbandon:a,mode:r="original"})=>{const[n,l]=d.useState(0),[i,o]=d.useState(null),{getNotificationStatus:u,alertState:x}=es(t,r),c=ge(r).readings,g=c[c.length-1],v=fe(r);d.useEffect(()=>{if(!(t!=null&&t.startTime))return;console.log("MealCycleTimer: Setting up timer with startTime",t.startTime);const b=()=>{const f=Date.now()-t.startTime;l(f);const y=I();o(y);const T=c[c.length-1];!!t.postprandialReadings[T]&&t.status!=="completed"&&a&&(console.log("Final reading completed. Automatically completing meal cycle."),a({status:"completed"}))},I=()=>{const h=c.filter(f=>!t.postprandialReadings[f]).sort((f,y)=>f-y);if(h.length===0)return null;for(const f of h){const y=u(f);if(!y.due&&!y.overdue)return{minutesMark:f,timeRemaining:y.timeUntil||0}}return null};b();const $=setInterval(b,1e3);return()=>clearInterval($)},[t==null?void 0:t.startTime,t==null?void 0:t.postprandialReadings,t==null?void 0:t.status,u,c,r,a]);const p=()=>{const b=Math.floor(n/1e3),I=Math.floor(b/60),$=b%60;return`${I.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`},N=b=>{const I=Math.ceil(b/1e3),$=Math.floor(I/60),h=I%60;return`${$.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}`},m=()=>{if(!(t!=null&&t.startTime))return 0;const b=n/1e3/60;return Math.min(b/g*100,100)},j=()=>{if(!i||i.timeRemaining<=0)return 100;const b=i.minutesMark,I=b*60*1e3-(b>c[0]?(b-c[0])*60*1e3:0),$=(I-i.timeRemaining)/I*100;return Math.min($,100)},C=b=>{if(!(t!=null&&t.postprandialReadings)||t.postprandialReadings[b])return!1;const I=u(b);return I.due&&!I.overdue},D=b=>!(t!=null&&t.postprandialReadings)||t.postprandialReadings[b]?!1:u(b).overdue,A=b=>t!=null&&t.postprandialReadings?!!t.postprandialReadings[b]:!1,k=b=>{s(b)},G=()=>{!t||t.status==="abandoned"||(console.log("MealCycleTimer: Abandoning meal cycle"),a({status:"canceled"}))};if(t&&t.startTime&&(Date.now()-t.startTime)/(60*1e3)>=v)return t.status!=="abandoned"&&G(),null;if(!t)return e.jsx(B,{className:"w-full",children:e.jsxs(z,{children:[e.jsx(H,{children:"No Active Meal Cycle"}),e.jsx(K,{children:"Start a new meal cycle to begin tracking your glucose readings."})]})});const Z=xe(t),X=tt(t);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full",children:e.jsxs(B,{className:"w-full",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(H,{children:"Active Meal Cycle"}),e.jsxs(K,{children:[t.preprandialReading?`Preprandial reading taken at ${pe(t.preprandialReading.timestamp)}`:"No preprandial reading",t.status==="abandoned"&&e.jsx("span",{className:"text-destructive ml-2",children:"(Abandoned)"})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[Z&&e.jsxs("span",{children:["Average: ",Z," mg/dL"]}),X&&e.jsxs("span",{className:"ml-4",children:["Peak: ",X," mg/dL"]})]})]}),t.status!=="abandoned"&&e.jsx(M,{variant:"outline",size:"icon",className:"text-destructive hover:text-destructive/80",onClick:G,title:"Cancel meal cycle",children:e.jsx(zs,{className:"h-6 w-6"})})]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"timer-circle h-24 w-24 rounded-full bg-muted flex items-center justify-center mb-2",children:e.jsx("div",{className:"text-2xl font-semibold text-foreground",children:t.startTime?p():"--:--"})}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.startTime?`First bite: ${pe(t.startTime)}`:"Awaiting first bite"})]}),e.jsx("div",{className:"w-full flex justify-between items-center text-xs text-muted-foreground mb-2",children:["FB",...c].map((b,I)=>{const $=I===0?se(t.startTime,"h:mma").replace("AM","a").replace("PM","p"):se(kt(t.startTime,Number(b)),"h:mma").replace("AM","a").replace("PM","p");return e.jsx("span",{className:"flex-1 text-center",children:$},b)})}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2.5",children:e.jsx("div",{className:"bg-peekdiet-primary h-2.5 rounded-full",style:{width:`${m()}%`}})}),i&&e.jsxs("div",{className:"mt-4 bg-accent/30 p-4 rounded-lg border border-accent",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-5 w-5 text-accent-foreground"}),e.jsx("span",{className:"text-base font-medium",children:i.timeRemaining>0?`Next reading in ${N(i.timeRemaining)}`:`${i.minutesMark}-minute reading due now!`})]}),e.jsxs("span",{className:"text-sm font-medium text-accent-foreground",children:[i.minutesMark," min"]})]}),e.jsx(ss,{value:j(),className:"h-2"})]}),(t.preprandialReading||Object.keys(t.postprandialReadings).length>0)&&e.jsx("div",{className:"h-32 w-full mt-4",children:e.jsx(as,{mealCycle:t})}),e.jsx("div",{className:"grid grid-cols-3 gap-2 pt-4",children:c.map(b=>{let I="outline",$=`${b} min`,h=!C(b);return A(b)?(I="ghost",$=`${b} min ✓`):C(b)?(I="default",$=`${b} min!`,h=!1):D(b)&&(I="ghost",$=`${b} min ✗`),e.jsx(M,{variant:I,disabled:h,onClick:()=>k(b),className:`
                      ${A(b)?"text-muted-foreground":""}
                      ${D(b)?"text-destructive opacity-50":""}
                      ${C(b)?"animate-pulse":""}
                    `,children:$},b)})}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs mt-3",children:[e.jsx("div",{className:"text-muted-foreground text-right",children:"Pre:"}),e.jsx("div",{className:"font-semibold",children:t.preprandialReading?`${t.preprandialReading.value} mg/dL`:"—"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Peak:"}),e.jsx("div",{className:"font-semibold",children:X?`${X} mg/dL`:"—"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Readings:"}),e.jsx("div",{className:"font-semibold",children:Object.keys(t.postprandialReadings).length+(t.preprandialReading?1:0)}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Status:"}),e.jsx("div",{className:"font-semibold capitalize",children:t.status})]})]}),e.jsx(Se,{children:t.status!=="abandoned"&&e.jsx(M,{variant:"outline",onClick:()=>a({status:"canceled"}),className:"w-full hover:bg-red-100 hover:text-red-700",children:"Cancel Meal Cycle"})})]})})})},Ua=Ie("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Va({className:t,variant:s,...a}){return e.jsx("div",{className:S(Ua({variant:s}),t),...a})}const _a=({mealCycles:t,onSelect:s,onDeleteSession:a})=>{const{activeMealCycle:r}=he(),[n,l]=ne.useState(null);ne.useEffect(()=>{if(!(r!=null&&r.startTime)){l(null);return}const o=fe()*60*1e3,u=r.startTime+o,x=()=>{const g=Date.now(),v=u-g;l(v>0?v:0)};x();const c=setInterval(x,1e3);return()=>clearInterval(c)},[r==null?void 0:r.startTime]);const i=o=>{const u=Math.ceil(o/1e3),x=Math.floor(u/3600),c=Math.floor(u%3600/60),g=u%60;return x>0?`${x}h ${c}m ${g}s`:`${c}m ${g}s`};return t.length===0?e.jsx("div",{className:"text-center p-4",children:e.jsx("p",{className:"text-muted-foreground",children:"No meal cycles recorded yet."})}):e.jsxs("div",{className:"space-y-4",children:[n!==null&&e.jsxs("div",{className:"flex items-center justify-center text-amber-500",children:[e.jsx(St,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:["Cycle ends in ",i(n)]})]}),e.jsx("h2",{className:"text-xl font-semibold",children:"Recent Meal Cycles"}),t.slice(0,2).map(o=>{var c;const u=xe(o),x=tt(o);return e.jsxs(B,{className:"meal-card cursor-pointer",onClick:()=>s&&s(o.id),children:[e.jsx(z,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(H,{className:"text-lg",children:o.preprandialReading?pe(o.preprandialReading.timestamp):"No preprandial reading"}),e.jsxs(K,{children:["ID: ",o.uniqueId,u!==null&&e.jsxs("span",{className:"ml-2 font-semibold",children:["Average: ",u," mg/dL"]})]})]}),e.jsx(Va,{variant:o.status==="completed"?"default":o.status==="active"?"outline":"secondary",children:o.status}),a&&o.status!=="active"&&e.jsx(M,{variant:"destructive",size:"sm",className:"ml-2",onClick:()=>a(o.id),children:"Delete"})]})}),e.jsxs(U,{children:[(o.status==="completed"||o.status==="abandoned"||Object.keys(o.postprandialReadings).length>0)&&e.jsx("div",{className:"h-32 w-full mt-2",children:e.jsx(Me,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:[{name:"Pre",glucose:(c=o.preprandialReading)==null?void 0:c.value},...Object.entries(o.postprandialReadings).sort(([g],[v])=>Number(g)-Number(v)).map(([g,v])=>({name:`${g}m`,glucose:v.value}))],margin:{top:5,right:5,left:5,bottom:5},children:[e.jsx(De,{strokeDasharray:"3 3",opacity:.2}),e.jsx(Le,{dataKey:"name",tick:{fontSize:10}}),e.jsx(Pe,{domain:["dataMin - 10","dataMax + 10"],tick:{fontSize:10}}),e.jsx(Ce,{formatter:g=>[`${g} mg/dL`,"Glucose"],labelFormatter:g=>g}),e.jsx(Ge,{type:"monotone",dataKey:"glucose",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})})}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs mt-3",children:[e.jsx("div",{className:"text-muted-foreground text-right",children:"Pre:"}),e.jsx("div",{className:"font-semibold",children:o.preprandialReading?`${o.preprandialReading.value} mg/dL`:"—"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Peak:"}),e.jsx("div",{className:"font-semibold",children:x?`${x} mg/dL`:"—"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Readings:"}),e.jsx("div",{className:"font-semibold",children:Object.keys(o.postprandialReadings).length+(o.preprandialReading?1:0)}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Status:"}),e.jsx("div",{className:"font-semibold capitalize",children:o.status})]})]})]},o.id)})]})},Ya=_s,Wa=Vs,ns=d.forwardRef(({className:t,...s},a)=>e.jsx(It,{ref:a,className:S("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));ns.displayName=It.displayName;const rs=d.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(Wa,{children:[e.jsx(ns,{}),e.jsxs(Mt,{ref:r,className:S("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a,children:[s,e.jsxs(Us,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));rs.displayName=Mt.displayName;const qa=d.forwardRef(({className:t,...s},a)=>e.jsx(Ot,{ref:a,className:S("text-lg font-semibold leading-none tracking-tight",t),...s}));qa.displayName=Ot.displayName;const Ka=d.forwardRef(({className:t,...s},a)=>e.jsx(Dt,{ref:a,className:S("text-sm text-muted-foreground",t),...s}));Ka.displayName=Dt.displayName;const st=()=>{const{user:t}=ae(),[s,a]=d.useState([]),[r,n]=d.useState(!0),[l,i]=d.useState(null);return d.useEffect(()=>{if(!t){n(!1);return}console.log("Setting up ad hoc readings listener...");const x=Ve(Ne(P,"adHocReadings"),_e("userId","==",t.uid)),c=Ys(x,g=>{console.log("Received ad hoc readings snapshot:",g.size,"documents");const v=[];g.forEach(p=>{const N=p.data(),m=N.timestamp instanceof Y?N.timestamp.toMillis():N.timestamp;console.log("Reading data:",{id:p.id,...N,timestamp:m}),v.push({id:p.id,...N,timestamp:m})}),v.sort((p,N)=>N.timestamp-p.timestamp),console.log("Processed readings:",v),a(v),n(!1)},g=>{console.error("Error fetching ad hoc readings:",g),i(g),n(!1)});return()=>{console.log("Cleaning up ad hoc readings listener"),c()}},[t]),{adHocReadings:s,loading:r,error:l,createAdHocReading:async x=>{if(!t)throw new Error("User must be authenticated to create ad hoc readings");try{const c=Y.now(),g={userId:t.uid,value:x,timestamp:c,type:"adhoc",createdAt:c,updatedAt:c};return{id:(await Rt(Ne(P,"adHocReadings"),g)).id,...g,timestamp:c.toMillis()}}catch(c){throw console.error("Error creating ad hoc reading:",c),c}},deleteAdHocReading:async x=>{if(!t)return me({title:"Error",description:"You must be logged in to delete readings.",variant:"destructive"}),!1;try{return await Xe(J(P,"adHocReadings",x)),a(c=>c.filter(g=>g.id!==x)),me({title:"Success",description:"Ad hoc reading deleted successfully.",variant:"default"}),!0}catch(c){return console.error("Error deleting ad hoc reading:",c),me({title:"Error",description:"Failed to delete ad hoc reading.",variant:"destructive"}),!1}}}},Za={original:{firstBite:0,readings:[20,40,60,90,120,180]},testing:{firstBite:0,readings:[3,6,9,12,15,18]}};function is(t="testing"){return Za[t]}const ht=()=>{const{loading:t}=ae(),{mealCycles:s,activeMealCycle:a,startMealCycle:r,recordFirstBite:n,recordPostprandialReading:l,abandonMealCycle:i,deleteMealCycle:o,clearAllSessions:u,isOffline:x,pendingMealCycle:c,error:g,isStartingMealCycle:v}=he();es(a);const{createAdHocReading:p}=st(),[N,m]=d.useState("idle"),[j,C]=d.useState(null),[D,A]=d.useState(!1),[k,G]=d.useState();if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})});d.useEffect(()=>(console.error("Dashboard mounted at:",new Date().toISOString()),a?console.log("Active meal cycle:",{id:a.id,startTime:a.startTime,preprandial:a.preprandialReading,status:a.status}):console.log("No active meal cycle"),c&&console.log("Pending meal cycle:",c),()=>{console.error("Dashboard unmounted at:",new Date().toISOString())}),[a,c]),d.useEffect(()=>{const R=a||c;if(R)try{const L=is("testing").readings,Q=R.postprandialReadings||{},le=L.every(de=>Q[de]!==void 0);console.error("🚨 ABANDONMENT DEBUG",{activeMealCycle:!!R,onAbandonCycle:typeof A,shouldAbandon:le,postprandialReadings:Object.keys(Q),expectedIntervals:L,cycleStatus:R.status,readingsDetails:L.map(de=>({interval:de,hasReading:Q[de]!==void 0,reading:Q[de]}))})}catch(L){console.error("Error in abandonment debug:",L)}},[a,c]),d.useEffect(()=>{console.log("🚨 DASHBOARD: modalStatus changed",{modalStatus:k})},[k]);const Z=()=>{m("preprandial")},X=()=>{m("adhoc")},b=async R=>{console.log("Starting meal cycle with preprandial value:",R),await r(R),m("idle"),console.log("Input mode reset to idle after starting meal cycle")},I=()=>{console.log("Recording first bite"),n()},$=R=>{C(R),m("postprandial")},h=R=>{j!==null&&l(j,R),m("idle"),C(null)},f=async R=>{try{await p(R),me({title:"Ad-hoc reading saved",description:"Your blood glucose reading has been recorded."}),m("idle")}catch(L){console.error("Error saving ad-hoc reading:",L),me({title:"Error saving reading",description:L instanceof Error?L.message:"Unknown error",variant:"destructive"})}},y=async()=>{console.log("🚨 Handling Abandon Confirm",{currentActiveMealCycle:a,currentModalStatus:k});try{G("canceled"),await i({status:"canceled",newVar:"Hello World"})?(console.log("🚨 Meal Cycle Successfully Canceled"),A(!1),G(void 0)):console.error("🚨 Failed to Cancel Meal Cycle")}catch(R){console.error("🚨 Error in Abandoning Meal Cycle:",R)}},T=async()=>{await i({status:"completed"})&&A(!1)},O=async R=>{await o(R)},E=async()=>{await u()},w=R=>{const L=()=>{console.log("🚨 Closing Modal"),A(!1),G(void 0)},Q=()=>{R==="active"?(console.log("🚨 Confirmed Meal Cycle Cancellation"),y()):L()};return e.jsx("div",{className:"flex justify-center w-full p-2",children:e.jsx(M,{variant:"default",onClick:Q,className:"w-20 h-10",children:"OK"})})},F=()=>x?e.jsxs(B,{className:"mb-4 border-destructive bg-destructive/10",children:[e.jsx(z,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"h-5 w-5 text-destructive"}),e.jsx(H,{className:"text-base text-destructive",children:"Offline Mode"})]})}),e.jsx(U,{children:e.jsx(K,{className:"text-destructive/90",children:"You're currently offline. Some features will be limited until your connection is restored. Your data will sync when you're back online."})})]}):null,W=()=>{var L;if(N==="preprandial")return e.jsx(Ue,{title:"Preprandial Reading",description:"Enter your blood glucose before eating",onSubmit:b,onCancel:()=>m("idle"),isLoading:v,onAbandonCycle:()=>A(!0)});if(N==="postprandial")return e.jsx(Ue,{title:`${j}-Minute Reading`,description:`Enter your blood glucose ${j} minutes after first bite`,onSubmit:h,onCancel:()=>m("idle"),onAbandonCycle:()=>A(!0)});if(N==="adhoc")return e.jsx(Ue,{title:"Ad-hoc Reading",description:"Enter your current blood glucose",onSubmit:f,onCancel:()=>m("idle"),onAbandonCycle:()=>A(!0)});const R=a||c;return R?!R.startTime||R.startTime===0?e.jsx("div",{className:"w-full",children:e.jsx(za,{onFirstBite:I,preprandialValue:(L=R.preprandialReading)==null?void 0:L.value,uniqueId:R.uniqueId})}):e.jsx("div",{className:"w-full",children:e.jsx(Ha,{mealCycle:R,onTakeReading:$,onAbandon:()=>A(!0),onComplete:T,onAbandonConfirm:()=>A(!0)})}):e.jsx(Ba,{onStartAdhoc:X,onStartMeal:Z})},V=()=>(console.log("🚨 Rendering Abandon Confirm Dialog",{showAbandonConfirm:D,modalStatus:k,activeMealCycleStatus:a==null?void 0:a.status}),e.jsx(Ya,{open:D,onOpenChange:R=>{R||G(void 0),A(R)},children:e.jsx(rs,{className:"sm:max-w-[200px] max-w-[180px]",onInteractOutside:R=>{R.preventDefault()},children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Continue"}),w(a==null?void 0:a.status)]})})}));return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("main",{className:"flex-1 container max-w-md mx-auto p-4",children:e.jsxs("div",{className:"space-y-6",children:[F(),W(),g&&e.jsx(B,{className:"border-destructive bg-destructive/10 mt-4",children:e.jsx(U,{className:"pt-4",children:e.jsxs("p",{className:"text-destructive text-sm",children:[e.jsx(Ws,{className:"h-4 w-4 inline mr-1"}),g]})})}),s.length>0&&N==="idle"&&e.jsxs("div",{children:[e.jsx(_a,{mealCycles:s,onDeleteSession:O}),e.jsx(M,{variant:"destructive",onClick:E,className:"w-full h-10 mt-4",children:"Clear All Sessions"})]})]})}),e.jsx(Fa,{}),V()]})},Xa=()=>{const{id:t}=qs(),{mealCycles:s,loading:a,error:r}=he(),[n,l]=d.useState(null);return d.useEffect(()=>{if(t&&s.length>0){const i=s.find(o=>o.id===t);l(i||null)}},[t,s]),a?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(B,{className:"max-w-md w-full",children:[e.jsx(z,{children:e.jsxs(H,{className:"text-red-500 flex items-center gap-2",children:[e.jsx(Ks,{className:"h-5 w-5"}),"Error"]})}),e.jsx(U,{children:e.jsx("p",{className:"text-gray-600",children:r})})]})}):n?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs(B,{className:"mb-6",children:[e.jsxs(z,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"h-5 w-5"}),"Meal Cycle Details"]}),e.jsx(K,{children:n.preprandialReading?`Preprandial reading taken at ${pe(n.preprandialReading.timestamp)}`:"No preprandial reading"})]}),e.jsx(U,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("p",{className:"font-medium capitalize",children:n.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Unique ID"}),e.jsx("p",{className:"font-medium",children:n.uniqueId})]})]}),n.preprandialReading&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Preprandial Reading"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Value"}),e.jsxs("p",{className:"font-medium",children:[n.preprandialReading.value," mg/dL"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Time"}),e.jsx("p",{className:"font-medium",children:pe(n.preprandialReading.timestamp)})]})]})]}),Object.keys(n.postprandialReadings).length>0&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Postprandial Readings"}),e.jsx("div",{className:"space-y-4",children:Object.entries(n.postprandialReadings).sort(([i],[o])=>Number(i)-Number(o)).map(([i,o])=>e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[i," minutes"]}),e.jsxs("p",{className:"font-medium",children:[o.value," mg/dL"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Time"}),e.jsx("p",{className:"font-medium",children:pe(o.timestamp)})]})]},o.id))})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(M,{variant:"outline",onClick:()=>window.history.back(),children:"Back to Dashboard"})})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(B,{className:"max-w-md w-full",children:[e.jsx(z,{children:e.jsx(H,{children:"Meal Cycle Not Found"})}),e.jsx(U,{children:e.jsx("p",{className:"text-gray-600",children:"The requested meal cycle could not be found."})})]})})},os=d.forwardRef(({className:t,...s},a)=>e.jsx(Pt,{className:S("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:a,children:e.jsx(Zs,{className:S("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));os.displayName=Pt.displayName;const Ja=()=>{const{user:t,logout:s}=ae(),[a,r]=d.useState(!0),[n,l]=d.useState("mg/dL"),i=async()=>{try{await s()}catch(o){console.error("Error logging out:",o)}};return t?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(B,{className:"max-w-2xl mx-auto",children:[e.jsxs(z,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),"Profile Settings"]}),e.jsx(K,{children:"Manage your account settings and preferences"})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{htmlFor:"email",children:"Email"}),e.jsx(we,{id:"email",type:"email",value:t.email||"",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{htmlFor:"displayName",children:"Display Name"}),e.jsx(we,{id:"displayName",type:"text",value:t.displayName||"",disabled:!0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(ue,{children:"Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive alerts for meal cycle readings"})]}),e.jsx(os,{checked:a,onCheckedChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ue,{children:"Glucose Unit"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(M,{variant:n==="mg/dL"?"default":"outline",onClick:()=>l("mg/dL"),children:"mg/dL"}),e.jsx(M,{variant:n==="mmol/L"?"default":"outline",onClick:()=>l("mmol/L"),children:"mmol/L"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(M,{variant:"outline",className:"w-full",onClick:i,children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Log Out"]})})]})]})}):null},ft=t=>t<65?"text-blue-600":t<=90?"text-green-600":t<=105?"text-yellow-600":t<=140?"text-orange-600":t<=180?"text-red-600":"text-purple-600",Qa=({mealCycles:t,adHocReadings:s=[]})=>{const a=ne.useMemo(()=>{const i={};return t.forEach(o=>{if(o.preprandialReading){const u=new Date(o.preprandialReading.timestamp).toDateString();i[u]||(i[u]=[]),i[u].push(o)}}),i},[t]),r=i=>{const o=i.map(xe).filter(u=>u!==null);return o.length>0?o.reduce((u,x)=>u+x,0)/o.length:null},n=ne.useMemo(()=>Object.entries(a).map(([i,o])=>{const u=r(o);return{name:se(new Date(i),"MM/dd"),glucose:u!==null?Number(u.toFixed(1)):null}}).filter(i=>i.glucose!==null).sort((i,o)=>new Date(i.name).getTime()-new Date(o.name).getTime()),[a]),l=ne.useMemo(()=>{const i=Object.entries(a).map(([o,u])=>r(u)).filter(o=>o!==null);return i.length>0?i.reduce((o,u)=>o+u,0)/i.length:null},[a]);return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Glucose History"}),e.jsx(it,{allowZeroExpanded:!0,children:e.jsxs(ot,{uuid:"running-average",children:[e.jsx(lt,{children:e.jsx(dt,{className:"bg-white p-4 border-b hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Running Average"}),l!==null&&e.jsxs("span",{className:`font-bold ${ft(l)}`,children:[l.toFixed(1)," mg/dL"]})]})})}),e.jsx(ct,{className:"p-4 bg-gray-50",children:e.jsx("div",{className:"w-full h-64",children:e.jsx(Me,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:n,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(De,{strokeDasharray:"3 3",opacity:.2}),e.jsx(Le,{dataKey:"name"}),e.jsx(Pe,{domain:["dataMin - 10","dataMax + 10"],label:{value:"Glucose (mg/dL)",angle:-90,position:"insideLeft"}}),e.jsx(Ce,{formatter:i=>[`${i} mg/dL`,"Daily Average"],labelFormatter:i=>`Date: ${i}`}),e.jsx(Ge,{type:"monotone",dataKey:"glucose",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})})})})]})}),e.jsx(it,{allowZeroExpanded:!0,children:Object.entries(a).map(([i,o])=>{const u=r(o);return e.jsxs(ot,{uuid:i,children:[e.jsx(lt,{children:e.jsx(dt,{className:"bg-white p-4 border-b hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold",children:i}),u!==null&&e.jsxs("span",{className:`font-bold ${ft(u)}`,children:[u.toFixed(1)," mg/dL"]})]})})}),e.jsx(ct,{className:"p-4 bg-gray-50",children:e.jsx("div",{className:"space-y-4",children:o.map(x=>{var c,g;return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{children:pe((c=x.preprandialReading)==null?void 0:c.timestamp)}),xe(x)!==null&&e.jsxs("span",{className:"font-semibold",children:["Avg: ",(g=xe(x))==null?void 0:g.toFixed(1)," mg/dL"]})]}),e.jsx("div",{className:"h-40 w-full",children:e.jsx(as,{mealCycle:x})})]},x.id)})})})]},i)})})]})},en=()=>{const{mealCycles:t,loading:s,error:a}=he(),{adHocReadings:r,loading:n,error:l}=st();if(d.useEffect(()=>(console.error("History mounted at:",new Date().toISOString()),()=>{console.error("History unmounted at:",new Date().toISOString())}),[]),s||n)return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-peekdiet-secondary"}),e.jsx("div",{className:"mt-4 h-4 w-32 bg-muted rounded"})]})})});if(a||l)return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container max-w-md mx-auto p-4",children:e.jsx("div",{className:"flex items-center gap-2 text-destructive",children:e.jsx("p",{className:"text-sm",children:a||(l==null?void 0:l.message)})})})});const i=t.filter(o=>["completed","abandoned","canceled"].includes(o.status));return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("main",{className:"container max-w-2xl mx-auto p-4",children:e.jsx(Qa,{mealCycles:i,adHocReadings:r})})})},tn=({reading:t})=>e.jsxs(B,{className:"opacity-90",children:[e.jsxs(z,{children:[e.jsx(H,{children:se(t.timestamp,"PPP p")}),e.jsx(K,{children:"Ad Hoc Reading"})]}),e.jsx(U,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs",children:[e.jsx("div",{className:"text-muted-foreground text-right",children:"Value:"}),e.jsxs("div",{className:"font-semibold",children:[t.value," mg/dL"]}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Type:"}),e.jsx("div",{className:"font-semibold capitalize",children:t.type})]})})]}),sn=()=>{const{mealCycles:t,loading:s,deleteMealCycle:a}=he(),{adHocReadings:r,loading:n,error:l,deleteAdHocReading:i}=st(),o=async g=>{await a(g)&&console.log(`Meal cycle ${g} deleted successfully`)},u=async g=>{await i(g)&&console.log(`Ad hoc reading ${g} deleted successfully`)};console.log("MealSessions - Ad Hoc Readings:",{count:r.length,readings:r,loading:n,error:l});const x=d.useMemo(()=>{console.log("Grouping readings...");const g={};return t.forEach(v=>{const p=se(v.startTime,"yyyy-MM-dd");g[p]||(g[p]={date:new Date(v.startTime),mealCycles:[],adHocReadings:[],dailyAverage:null}),g[p].mealCycles.push(v)}),r.forEach(v=>{console.log("Processing ad hoc reading:",v);const p=se(v.timestamp,"yyyy-MM-dd");g[p]||(g[p]={date:new Date(v.timestamp),mealCycles:[],adHocReadings:[],dailyAverage:null}),g[p].adHocReadings.push(v)}),Object.values(g).forEach(v=>{const p=[...v.mealCycles.flatMap(N=>[N.preprandialReading,...Object.values(N.postprandialReadings)]),...v.adHocReadings].filter(N=>N&&N.value!==null&&N.value!==void 0&&N.value>0);if(p.length>0){const N=p.reduce((m,j)=>m+j.value,0);v.dailyAverage=Math.round(N/p.length)}}),console.log("Grouped readings:",g),g},[t,r]),c=d.useMemo(()=>Object.values(x).sort((g,v)=>v.date.getTime()-g.date.getTime()),[x]);return s||n?e.jsx("div",{children:"Loading..."}):l?(console.error("Error with ad hoc readings:",l),e.jsxs("div",{children:["Error loading ad hoc readings: ",l.message]})):e.jsx("div",{className:"space-y-8 px-[2rem]",children:c.map(({date:g,mealCycles:v,adHocReadings:p,dailyAverage:N})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:se(g,"PPP")}),N!==null&&e.jsxs("span",{className:"text-lg font-semibold",children:["Daily Average: ",N," mg/dL"]})]}),e.jsxs("div",{className:"space-y-4",children:[v.map(m=>{var A;const j=xe(m),C=tt(m),D=is("original").readings;return e.jsxs(B,{className:"relative",children:[["completed","canceled","abandoned"].includes(m.status)&&e.jsx(M,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-10",onClick:()=>o(m.id),children:e.jsx(ut,{className:"h-4 w-4 text-destructive"})}),e.jsxs(z,{children:[e.jsx(H,{children:se(m.startTime,"p")}),e.jsxs(K,{children:["ID: ",m.uniqueId,j!==null&&e.jsxs("span",{className:"ml-2 font-semibold",children:["Average: ",j," mg/dL"]})]})]}),e.jsxs(U,{children:[(m.status==="completed"||m.status==="abandoned"||Object.keys(m.postprandialReadings).length>0)&&e.jsxs("div",{className:"h-32 w-full mt-2",children:[e.jsx("div",{className:"w-full flex justify-between items-center text-xs text-gray-500 mb-2",children:["FB",...D].map((k,G)=>{const Z=G===0?se(m.startTime,"h:mma"):se(kt(m.startTime,Number(k)),"h:mma");return e.jsx("span",{className:"flex-1 text-center",children:Z},k)})}),e.jsx(Me,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:[{name:"Pre",glucose:(A=m.preprandialReading)==null?void 0:A.value},...Object.entries(m.postprandialReadings).sort(([k],[G])=>Number(k)-Number(G)).map(([k,G])=>({name:`${k}m`,glucose:G.value}))],margin:{top:5,right:5,left:5,bottom:5},children:[e.jsx(De,{strokeDasharray:"3 3",opacity:.2}),e.jsx(Le,{dataKey:"name",tick:{fontSize:10}}),e.jsx(Pe,{domain:["dataMin - 10","dataMax + 10"],tick:{fontSize:10}}),e.jsx(Ce,{formatter:k=>[`${k} mg/dL`,"Glucose"],labelFormatter:k=>k}),e.jsx(Ge,{type:"monotone",dataKey:"glucose",stroke:"#8B5CF6",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs mt-3",children:[e.jsx("div",{className:"text-muted-foreground text-right",children:"Pre:"}),e.jsx("div",{className:"font-semibold",children:m.preprandialReading?`${m.preprandialReading.value} mg/dL`:"—"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Peak:"}),e.jsx("div",{className:"font-semibold",children:C?`${C} mg/dL`:"—"}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Readings:"}),e.jsx("div",{className:"font-semibold",children:Object.keys(m.postprandialReadings).length+(m.preprandialReading?1:0)}),e.jsx("div",{className:"text-muted-foreground text-right",children:"Status:"}),e.jsx("div",{className:"font-semibold capitalize",children:m.status})]})]})]},m.id)}),p.map(m=>e.jsxs(B,{className:"relative",children:[e.jsx(M,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-10",onClick:()=>u(m.id),children:e.jsx(ut,{className:"h-4 w-4 text-destructive"})}),e.jsx(tn,{reading:m})]},m.id))]})]},g.toISOString()))})},an=()=>(d.useEffect(()=>(console.error("TrackGlucose mounted at:",new Date().toISOString()),()=>{console.error("TrackGlucose unmounted at:",new Date().toISOString())}),[]),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Track Glucose"}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx("p",{children:"Glucose tracking functionality coming soon..."})})]})),nn=()=>{const t=Je();return d.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},ls=d.forwardRef(({className:t,...s},a)=>e.jsx(Gt,{ref:a,className:S("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));ls.displayName=Gt.displayName;const ds=d.forwardRef(({className:t,...s},a)=>e.jsx($t,{ref:a,className:S("aspect-square h-full w-full",t),...s}));ds.displayName=$t.displayName;const cs=d.forwardRef(({className:t,...s},a)=>e.jsx(Ft,{ref:a,className:S("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));cs.displayName=Ft.displayName;const rn=ta,on=sa,ln=d.forwardRef(({className:t,inset:s,children:a,...r},n)=>e.jsxs(Bt,{ref:n,className:S("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",t),...r,children:[a,e.jsx(Xs,{className:"ml-auto h-4 w-4"})]}));ln.displayName=Bt.displayName;const dn=d.forwardRef(({className:t,...s},a)=>e.jsx(zt,{ref:a,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s}));dn.displayName=zt.displayName;const us=d.forwardRef(({className:t,sideOffset:s=4,...a},r)=>e.jsx(Js,{children:e.jsx(Ht,{ref:r,sideOffset:s,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}));us.displayName=Ht.displayName;const ke=d.forwardRef(({className:t,inset:s,...a},r)=>e.jsx(Ut,{ref:r,className:S("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",t),...a}));ke.displayName=Ut.displayName;const cn=d.forwardRef(({className:t,children:s,checked:a,...r},n)=>e.jsxs(Vt,{ref:n,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:a,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(_t,{children:e.jsx(Qs,{className:"h-4 w-4"})})}),s]}));cn.displayName=Vt.displayName;const un=d.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(Yt,{ref:r,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(_t,{children:e.jsx(ea,{className:"h-2 w-2 fill-current"})})}),s]}));un.displayName=Yt.displayName;const ms=d.forwardRef(({className:t,inset:s,...a},r)=>e.jsx(Wt,{ref:r,className:S("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...a}));ms.displayName=Wt.displayName;const Ze=d.forwardRef(({className:t,...s},a)=>e.jsx(qt,{ref:a,className:S("-mx-1 my-1 h-px bg-muted",t),...s}));Ze.displayName=qt.displayName;const mn=()=>{var o;const t=Je(),{user:s,logout:a}=ae(),[r,n]=d.useState(!1),l=u=>t.pathname===u||u==="/dashboard"&&t.pathname==="/",i=[{path:"/dashboard",icon:ra,label:"Dashboard"},{path:"/history",icon:ia,label:"History"},{path:"/sessions",icon:Lt,label:"Sessions"},{path:"/track",icon:oa,label:"Track Glucose"},{path:"/about",icon:la,label:"About"},{path:"/profile",icon:Ye,label:"Profile"}];return e.jsxs("nav",{className:"bg-white shadow-sm",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>n(!r),className:"text-gray-500 hover:text-gray-700",children:r?e.jsx(Re,{className:"h-6 w-6"}):e.jsx(aa,{className:"h-6 w-6"})})}),e.jsx("div",{className:"hidden",children:i.map(u=>e.jsxs(mt,{to:u.path,className:`inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ${l(u.path)?"border-peekdiet-primary text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"}`,children:[e.jsx(u.icon,{className:"h-5 w-5 mr-2"}),u.label]},u.path))}),e.jsx("div",{className:"flex items-center",children:s?e.jsxs(rn,{children:[e.jsx(on,{asChild:!0,children:e.jsx(M,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:e.jsxs(ls,{className:"h-8 w-8",children:[e.jsx(ds,{src:s.photoURL||void 0,alt:s.displayName||"User"}),e.jsx(cs,{children:((o=s.displayName)==null?void 0:o.charAt(0))||"U"})]})})}),e.jsxs(us,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(ms,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:s.displayName}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:s.email})]})}),e.jsx(Ze,{}),e.jsxs(ke,{children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Profile"})]}),e.jsxs(ke,{children:[e.jsx(na,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Settings"})]}),e.jsx(Ze,{}),e.jsxs(ke,{onClick:()=>a(),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]}):e.jsx(M,{size:"sm",variant:"default",children:"Sign In"})})]})}),r&&e.jsx("div",{className:"block",children:e.jsx("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3",children:i.map(u=>e.jsx(mt,{to:u.path,className:`block px-3 py-2 rounded-md text-base font-medium ${l(u.path)?"bg-peekdiet-primary text-white":"text-gray-500 hover:bg-gray-50 hover:text-gray-700"}`,onClick:()=>n(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(u.icon,{className:"h-5 w-5 mr-2"}),u.label]})},u.path))})})]})},gs=d.forwardRef(({className:t,orientation:s="horizontal",decorative:a=!0,...r},n)=>e.jsx(Kt,{ref:n,decorative:a,orientation:s,className:S("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...r}));gs.displayName=Kt.displayName;const gn=()=>e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8 text-center",children:"Metabolic Tracking: Your Personal Health Insights"}),e.jsxs(B,{className:"mb-8",children:[e.jsx(z,{children:e.jsx(H,{children:"Why This App is a Game-Changer for Personal Health"})}),e.jsxs(U,{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Structured Testing = Clamp-Like Rigor"}),e.jsxs("ul",{className:"list-disc pl-6 mb-6",children:[e.jsxs("li",{children:["The ",e.jsx("strong",{children:"6 readings over 3 hours"})," mirror the frequency of research-grade clamp studies, capturing:"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"First-phase insulin response"})," (30–60 mins post-meal)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Second-phase insulin action"})," (2–3 hours post-meal)"]}),e.jsxs("li",{children:["Unlike sporadic testing, this protocol detects ",e.jsx("strong",{children:"delayed glucose clearance"})," (a hallmark of insulin resistance)"]})]})]})]}),e.jsxs(B,{className:"mb-8",children:[e.jsx(z,{children:e.jsx(H,{children:"Who Should Use It?"})}),e.jsx(U,{children:e.jsxs("ul",{className:"list-disc pl-6",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Prediabetics/Diabetics"}),": Catch post-meal spikes masked by normal fasting glucose"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Biohackers"}),": Optimize diets for metabolic flexibility"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Athletes"}),": Fine-tune carb tolerance for performance"]}),e.jsxs("li",{children:[e.jsx("strong",{children:'Anyone with "Unexplained" Fatigue/Brain Fog'}),": Hidden hyperglycemia could be the culprit"]})]})})]}),e.jsxs(B,{className:"mb-8",children:[e.jsx(z,{children:e.jsx(H,{children:"How to Get the Most Out of It"})}),e.jsxs(U,{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Test 3–5 Signature Meals"}),e.jsxs("ul",{className:"list-disc pl-6 mb-6",children:[e.jsx("li",{children:"High-carb (e.g., rice)"}),e.jsx("li",{children:"High-fat (e.g., avocado + nuts)"}),e.jsx("li",{children:"Mixed (e.g., pizza)"})]}),e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Intervene Based on Data"}),e.jsxs("ul",{className:"list-disc pl-6",children:[e.jsx("li",{children:"If glucose >140 mg/dL at 1 hour → try vinegar before meals or walking post-meal"}),e.jsx("li",{children:"If glucose stays high at 3 hours → reduce carb portion size"})]})]})]}),e.jsx(gs,{className:"my-8"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Final Verdict"}),e.jsxs("p",{className:"text-lg mb-6",children:["This app is ",e.jsx("strong",{children:"one of the best practical tools"})," for metabolic self-awareness outside a lab. While not a true clamp, it brings ",e.jsx("strong",{children:"scientific methodology to personal health"}),"—letting users detect dysfunction early and intervene."]}),e.jsxs("p",{className:"text-lg font-semibold",children:["Recommendation: Use it alongside ",e.jsx("strong",{children:"fasting insulin tests"})," and ",e.jsx("strong",{children:"ketone monitoring"}),". For proactive individuals, this is a ",e.jsx("strong",{children:"no-brainer"}),"."]})]})]});function pn(){return e.jsx(da,{children:e.jsx(fa,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(mn,{}),e.jsxs(ca,{children:[e.jsx(ee,{path:"/login",element:e.jsx(Ta,{})}),e.jsx(ee,{path:"/",element:e.jsx(ie,{children:e.jsx(ht,{})})}),e.jsx(ee,{path:"/dashboard",element:e.jsx(ie,{children:e.jsx(ht,{})})}),e.jsx(ee,{path:"/history",element:e.jsx(ie,{children:e.jsx(en,{})})}),e.jsx(ee,{path:"/sessions",element:e.jsx(ie,{children:e.jsx(sn,{})})}),e.jsx(ee,{path:"/track",element:e.jsx(ie,{children:e.jsx(an,{})})}),e.jsx(ee,{path:"/meal-cycle/:id",element:e.jsx(ie,{children:e.jsx(Xa,{})})}),e.jsx(ee,{path:"/profile",element:e.jsx(ie,{children:e.jsx(Ja,{})})}),e.jsx(ee,{path:"/about",element:e.jsx(ie,{children:e.jsx(gn,{})})}),e.jsx(ee,{path:"*",element:e.jsx(nn,{})})]}),e.jsx(ja,{})]})})})}ua(document.getElementById("root")).render(e.jsx(pn,{}));
